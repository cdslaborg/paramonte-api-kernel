<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParaMonte: D:/Dropbox/Projects/20180101_ParaMonte/git/src/kernel/temp/Classification_mod@MinVolPartition.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="html_extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://www.cdslab.org/paramonte/" target="_blank"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParaMonte
   &#160;<span id="projectnumber">1.5.1</span>
   </div>
   <div id="projectbrief">Plain Powerful Parallel Monte Carlo Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_28b7b70ecda10deda60b84e2abbbebd1.html">temp</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">Classification_mod@MinVolPartition.f90</div></div>
</div><!--header-->
<div class="contents">
<a href="temp_2Classification__mod_0dMinVolPartition_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span>submodule(<a class="code hl_namespace" href="namespaceclassification.html">classification</a>) minvolpartition</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span>  </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span>    <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">!***********************************************************************************************************************************</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">!***********************************************************************************************************************************</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keyword">contains</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">!***********************************************************************************************************************************</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">!***********************************************************************************************************************************</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>    <span class="keyword">module</span> subroutine getminvolpartition( ncmax, nd, np             &amp;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>                                          , stabilizationrequested    &amp;</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>                                          , maxkvolumelooprecursion   &amp;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>                                          , maxallowedkmeansfailure   &amp;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>                                          , maxallowedminvolfailure   &amp;</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>                                          , mahalsqweightexponent     &amp;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>                                          , tightness                 &amp;</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>                                          , inclusionfraction         &amp;</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>                                          , parlogvol                 &amp;</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>                                          , point                     &amp;</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>                                          , ncoptimal                 &amp;</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>                                          , ccenter                   &amp;</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>                                          , csize                     &amp;</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>                                          , cbeinvcovmat              &amp;</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>                                          , cbecholcov                &amp;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>                                          , cbecholdiag               &amp;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>                                          , cbevolnormed              &amp;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>                                          , cmembership               &amp;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>                                          , pointindex                &amp;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>                                          , convergencefailurecounter &amp;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>                                          )</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacematrix__mod.html">matrix_mod</a>     , <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacestatistics__mod.html">statistics_mod</a> , <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>, <a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>        <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: ncMax,nd,np                 <span class="comment">! maximum number of clusters, number of dimensions, number of points</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>        <span class="keywordtype">logical</span> , <span class="keywordtype">intent(in)</span>    :: stabilizationRequested</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxKvolumeLoopRecursion</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxAllowedKmeansFailure</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxAllowedMinVolFailure</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: mahalSqWeightExponent</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: tightness                   <span class="comment">! the factor deremining how large the bounding ellipsoid can be, compared to the true volume of the ellipsoid.</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: inclusionFraction           <span class="comment">! the fraction of non-cluster-member points that ARE inside the cluster, to be considered in the estimation of the true volume of the cluster.</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: parLogVol                   <span class="comment">! input log-estimate of the total volume of the points.</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: Point(nd,np)                <span class="comment">! the input data (points) to be clustered. on output, it is ordered.</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(out)</span>   :: CCenter(nd,ncMax)           <span class="comment">! Centers of the clusters (nd,ncMax)</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(out)</span>   :: CBEInvCovMat(nd,nd,ncMax)   <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: Full symmetric Inverse Covariance Matrices of the Bounding Ellipsoids of all clusters.</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(out)</span>   :: CBECholCov(nd,nd,ncMax)     <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: The lower triangle contains the Cholesky factor of the covariance matrix of the input points, the upper triangle maybe the CovMat itself (not needed). On output contains in the lower triangle, the Cholesky factor of all clusters found.</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(out)</span>   :: CBECholDiag(nd,ncMax)       <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: The diagonal elements of the Cholesky factor of the covariance matrix of the input points, on output, contains the cholesky factor of all found clusters.</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(out)</span>   :: CBEVolNormed(ncMax)         <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: Each element of the array contains the volume of the corresponding Cluster Bounding Ellipsoid.</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: ncOptimal                   <span class="comment">! this variable is saved throughout recursive iterations of subroutine</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: CSize(ncMax)                <span class="comment">! cluster sizes (nCMax)</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: CMembership(np)             <span class="comment">! the CMembership id of each point (representing the cluster number to which the point belongs)</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: PointIndex(np)              <span class="comment">! Vector containing the scrambled indices of Point elements. It represent the mapping from the input Point elements to output scrambled Point vector.</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: convergenceFailureCounter   <span class="comment">! number of times the algorithm failed to converge.</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        <span class="keywordtype">integer</span>                 :: i,j</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="keywordtype">        real</span>(RK)                :: parVolNormed  <span class="comment">! LogVolume of parent ellipsoid</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="keywordtype">        real</span>(RK)                :: logNormFac, scaleFac</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        <span class="comment">!ncMax = np/(nd+1)</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>        ccenter(1:nd,1) = 0._rk</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <span class="keywordflow">do</span> j = 1,np</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            ccenter(1:nd,1) = ccenter(1:nd,1) + point(1:nd,j)</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            pointindex(j) = j</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="keywordflow">        end do</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        ccenter(1:nd,1) = ccenter(1:nd,1) / real(np,kind=rk)</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        <span class="keyword">call </span><a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>( nd, np, ccenter(1:nd,1), point, cbecholcov(1:nd,1:nd,1), cbecholdiag(1:nd,1) )   <span class="comment">! get Cholesky Factor of cluster samples</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        <span class="keywordflow">if</span> (cbecholdiag(1,1)&lt;0._rk) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>            <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;getCholeskyFactor() failed in getSamCholFac() in getMinVolPartition()&#39;</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Max cluster number, dimension, total points:&#39;</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>            <span class="keyword">write</span>(*,*) ncmax, nd, np</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            stop</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        cbeinvcovmat(1:nd,1:nd,1) = <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a>(nd,cbecholcov(1:nd,1:nd,1),cbecholdiag(1:nd,1))</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        scalefac = sqrt( maxval(<a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a>(nd, np, ccenter(1:nd,1), cbeinvcovmat(1:nd,1:nd,1), point)) )</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        cbevolnormed(1) = sum(log(cbecholdiag(1:nd,1))) + nd*log(scalefac)   <span class="comment">! Get the LogVolume of the first cluster. This will be used to normalize the volumes of all child clusters.</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <span class="keywordflow">if</span> (cbevolnormed(1)&gt;parlogvol) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            lognormfac = cbevolnormed(1)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            cbevolnormed(1) = 1._rk</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>            parvolnormed = exp( parlogvol - lognormfac )</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="keywordflow">else</span>    <span class="comment">! enlarge the bounding ellipsoid</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            <span class="comment">!write(*,*) &#39;no no no no!&#39;</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            lognormfac = parlogvol</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            <span class="comment">!scaleFac = scaleFac * exp( 0.5_RK*(logNormFac-CBEVolNormed(1))/nd )</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            scalefac = scalefac * exp( (lognormfac-cbevolnormed(1))/nd )</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            cbevolnormed(1) = 1._rk</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            parvolnormed = 1._rk</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        <span class="keywordflow">if</span> (ncmax &gt; 1 .and. cbevolnormed(1)&gt;tightness*parvolnormed) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            <span class="comment">!convergenceFailureCounter = 0</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="keyword">call </span>runminvolkernel( ncmax, nd, np             &amp;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                                , stabilizationrequested    &amp;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                                , maxkvolumelooprecursion   &amp;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                                , maxallowedkmeansfailure   &amp;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                                , maxallowedminvolfailure   &amp;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                                , mahalsqweightexponent     &amp;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                                , tightness                 &amp;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                                , inclusionfraction         &amp;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>                                , parvolnormed              &amp;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                                , lognormfac                &amp;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>                                , point                     &amp;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                                , ncoptimal                 &amp;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                                , ccenter                   &amp;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                                , csize                     &amp;</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                                , cbeinvcovmat              &amp;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                                , cbecholcov                &amp;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>                                , cbecholdiag               &amp;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                                , cbevolnormed              &amp;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                                , cmembership               &amp;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                                , pointindex                &amp;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                                , convergencefailurecounter &amp;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                                )</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>            <span class="keywordflow">else</span> <span class="comment">! There is only one cluster</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                ncoptimal = 1</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="keywordflow">            end if</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        <span class="keywordflow">if</span> (ncoptimal==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>            <span class="keywordflow">do</span> j = 1,nd-1 <span class="comment">! Now rescale Cholesky factor and its diagonals, such that they describe the bounding ellipsoid of the cluster</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                cbecholdiag(j,1) = cbecholdiag(j,1) * scalefac</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                <span class="keywordflow">do</span> i = j+1,nd</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                    cbecholcov(i,j,1) = cbecholcov(i,j,1) * scalefac</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="keywordflow">                end do</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            cbecholdiag(nd,1) = cbecholdiag(nd,1) * scalefac</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            cbeinvcovmat(1:nd,1:nd,1) = cbeinvcovmat(1:nd,1:nd,1) / scalefac**2</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keyword">end subroutine </span>getminvolpartition</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment">!***********************************************************************************************************************************</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment">!***********************************************************************************************************************************</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="comment">! This code assumes that ncMax &gt; 1 on input.</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="comment">! important input requirements:</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="keywordtype">recursive</span> <span class="keyword">subroutine </span>runminvolkernel    ( ncMax, nd, np             &amp;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>                                            , stabilizationRequested    &amp;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>                                            , maxKvolumeLoopRecursion   &amp;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>                                            , maxAllowedKmeansFailure   &amp;</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>                                            , maxAllowedMinVolFailure   &amp;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                                            , mahalSqWeightExponent     &amp;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>                                            , tightness                 &amp;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                                            , inclusionFraction         &amp;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                                            , parVolNormed              &amp;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                                            , logNormFac                &amp;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                                            , Point                     &amp;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                                            , ncOptimal                 &amp;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                                            , CCenter                   &amp;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                                            , CSize                     &amp;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                                            , CBEInvCovMat              &amp;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                                            , CBECholCov                &amp;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                                            , CBECholDiag               &amp;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>                                            , CBEVolNormed              &amp;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                                            , CMembership               &amp;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                                            , PointIndex                &amp;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                                            , convergenceFailureCounter &amp;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                                            )</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacestatistics__mod.html">statistics_mod</a>  , <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>, <a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a>     <span class="comment">!, getRandPointOnEllipsoid    ! last one is for debugging</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacematrix__mod.html">matrix_mod</a>      , <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">save</span>          :: ncall=0</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: ncMax                             <span class="comment">! maximum number of clusters determined from the nd and np</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: nd,np                             <span class="comment">! number of dimensions, number of points</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="keywordtype">logical</span> , <span class="keywordtype">intent(in)</span>    :: stabilizationRequested</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxKvolumeLoopRecursion</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxAllowedKmeansFailure</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxAllowedMinVolFailure</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: mahalSqWeightExponent</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: tightness                         <span class="comment">! the factor deremining how large the bounding ellipsoid can be, compared to the true volume of the ellipsoid.</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: inclusionFraction                 <span class="comment">! the fraction of non-cluster-member points that ARE inside the cluster, to be considered in the estimation of the true volume of the cluster.</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: parVolNormed                      <span class="comment">! parent&#39;s sqrt(det(invCovMat)), where invCovMat is the inverse covariance matrix of the bounding ellipsoid of the input points.</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(in)</span>    :: logNormFac                        <span class="comment">! parent&#39;s sqrt(det(invCovMat)), where invCovMat is the inverse covariance matrix of the bounding ellipsoid of the input points.</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: ncOptimal                         <span class="comment">! this variable is saved throughout recursive iterations of subroutine</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: CSize(ncMax)                      <span class="comment">! cluster sizes (nCMax)</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: convergenceFailureCounter         <span class="comment">! returns the number of times the algorithm failed to converge.</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: CMembership(np)                   <span class="comment">! the CMembership id of each point (representing the cluster number to which the point belongs)</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: PointIndex(np)                    <span class="comment">! Vector containing the scrambled indices of Point elements. It represent the mapping from the input Point elements to output scrambled Point vector.</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: Point(nd,np)                      <span class="comment">! the input data (points) to be clustered.</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: CCenter(nd,ncMax)                 <span class="comment">! Centers of the clusters (nd,ncMax)</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: CBECholCov(nd,nd,ncMax)           <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The lower triangle contains the Cholesky factor of the covariance matrix of the input points, the upper triangle maybe the CovMat itself (not needed). On output contains in the lower triangle, the Cholesky factor of all clusters found.</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: CBEInvCovMat(nd,nd,ncMax)         <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The lower triangle contains the Cholesky factor of the covariance matrix of the input points, the upper triangle maybe the CovMat itself (not needed). On output contains in the lower triangle, the Cholesky factor of all clusters found.</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: CBECholDiag(nd,ncMax)             <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The diagonal elements of the Cholesky factor of the covariance matrix of the input points, on output, contains the cholesky factor of all found clusters.</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="keywordtype">        real</span>(RK), <span class="keywordtype">intent(inout)</span> :: CBEVolNormed(ncMax)               <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The volume of the Bounding Ellipsoid of the parent cluster. On output: The Bounding volume of all child clusters.</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="keywordtype">        real</span>(RK)                :: CKCenter(nd,2)                    <span class="comment">! Cluster Centers for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="keywordtype">        real</span>(RK)                :: CKBECholCov(nd,nd,2)              <span class="comment">! Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters, reported in the upper triangle. The lower triangle contains the Cholesky factors</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="keywordtype">        real</span>(RK)                :: CKBEInvCovMat(nd,nd,2)            <span class="comment">! Inverse of the Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="keywordtype">        real</span>(RK)                :: CKBECholDiag(nd,2)                <span class="comment">! determinants of the inverse covariance matrices of the bounding ellipsoids of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="keywordtype">        real</span>(RK)                :: CKMahalSq(np,2)                   <span class="comment">! Vector of Maximum Mahalanobis distances for each cluster</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="keywordtype">        real</span>(RK)                :: CKBEVolNormed(2)                  <span class="comment">! New Cluster Bounding Ellisoid Volumes</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="keywordtype">        real</span>(RK)                :: CKParVolNormed(2)                 <span class="comment">! New Cluster Volume estimates</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="keywordtype">        real</span>(RK)                :: ScaleFacSq(2),ScaleFac(2)         <span class="comment">! The factor by which determinant must be multiplied in order for the ellipsoid to become a bounding ellipsoid.</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="keywordtype">        real</span>(RK)                :: CKPoint(nd,np)                    <span class="comment">! Cluster Points in 2-means partition result</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="keywordtype">        real</span>(RK)                :: MahalSqWeight(2)                  <span class="comment">! MahalSqWeight definition of Lu et al 2007</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="keywordtype">integer</span>                 :: CKPointIndex(np)                  <span class="comment">! Vector containing the scrambled indices of Point elements. It represent the mapping from the input Point elements to output scrambled Point vector.</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        <span class="keywordtype">integer</span>                 :: CKSize(2)                         <span class="comment">! cluster sizes for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="keywordtype">integer</span>                 :: NumPointInCK(2)                   <span class="comment">! cluster sizes for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <span class="keywordtype">integer</span>                 :: CKSizeDummy(2)                    <span class="comment">! cluster sizes for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="keywordtype">integer</span>                 :: CKncMax(2)                        <span class="comment">! maximum allowed number of potential clusters in each of the two K-means clusters.</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        <span class="keywordtype">integer</span>                 :: CKncOptimal(2)                    <span class="comment">! optimal number of clusters in each of the child clusters</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        <span class="keywordtype">integer</span>                 :: CMemberCounter(2)                 <span class="comment">! cluster member counter</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        <span class="keywordtype">integer</span>                 :: zcsIteration                      <span class="comment">! Counts the number of times zero sized clusters are found, zcs stands for zero cluster size</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <span class="keywordtype">integer</span>                 :: IpStart(2),IpEnd(2)</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        <span class="keywordtype">integer</span>                 :: i,j,ip,ic,icOther,iteration,ndEffective</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        <span class="keywordtype">integer</span>                 :: icStart,icEnd,recursionCounter,kmeansFailureCounter,minVolFailureCounter</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        <span class="keywordtype">logical</span>                 :: reclusteringNeeded</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        <span class="keywordtype">integer</span>                 :: minClusterSize</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        <span class="comment">! stabilization variables:</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="keywordtype">        real</span>(RK)                :: CKCenterOld(nd,2)                 <span class="comment">! Cluster Centers for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="keywordtype">        real</span>(RK)                :: CKBECholCovOld(nd,nd,2)           <span class="comment">! Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters, reported in the upper triangle. The lower triangle contains the Cholesky factors</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="keywordtype">        real</span>(RK)                :: CKBEInvCovMatOld(nd,nd,2)         <span class="comment">! Inverse of the Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="keywordtype">        real</span>(RK)                :: CKBECholDiagOld(nd,2)             <span class="comment">! determinants of the inverse covariance matrices of the bounding ellipsoids of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="keywordtype">        real</span>(RK)                :: CKMahalSqOld(np,2)                <span class="comment">! Vector of Maximum Mahalanobis distances for each cluster</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="keywordtype">        real</span>(RK)                :: CKBEVolNormedOld(2)               <span class="comment">! New Cluster Bounding Ellisoid Volumes</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span><span class="keywordtype">        real</span>(RK)                :: ScaleFacSqOld(2),ScaleFacOld(2)   <span class="comment">! The factor by which determinant must be multiplied in order for the ellipsoid to become a bounding ellipsoid.</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        minclustersize = nd+1</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>        ndeffective = np / ncmax + 1</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        ncall = ncall + 1</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>        kmeansfailurecounter = 0</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>        <span class="keywordflow">do</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="keyword">call </span>runkmeans(.true.,2,nd,np,point,ckcenter,cksize,cmembership,iteration,zcsiteration)</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            <span class="keywordflow">if</span> ( any(cksize&lt;minclustersize) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                kmeansfailurecounter = kmeansfailurecounter + 1</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                <span class="keywordflow">if</span> (kmeansfailurecounter&gt;maxallowedkmeansfailure) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                    ncoptimal = 1</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                    cmembership = 1</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>                    csize(1) = np</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>                    convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>                    <span class="keywordflow">return</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                cycle</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span><span class="keywordflow">            end if</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>            <span class="keywordflow">exit</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span><span class="keywordflow">        end do</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        <span class="comment">! **********************************************************************************************</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        <span class="comment">! **********************************************************************************************</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        ckbevolnormedold = huge(0._rk)</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        recursioncounter = 0</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        minvolfailurecounter = 0</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        looprecursiverunminvolkernel: <span class="keywordflow">do</span>    <span class="comment">! find two approximately minimum-volume sub-cllusters recursively</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            recursioncounter = recursioncounter + 1</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            <span class="keywordflow">if</span>(mod(recursioncounter,maxkvolumelooprecursion)==0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;recursionCounter: &#39;</span>, recursioncounter</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>                ncoptimal = 1</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>                cmembership = 1</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>                csize(1) = np</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>                convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>                <span class="keywordflow">return</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="keywordflow">            end if</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            cmembercounter(1) = 0</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            cmembercounter(2) = cksize(1)</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            <span class="keywordflow">do</span> ip = 1,np</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>                <span class="keywordflow">if</span> (cmembership(ip)==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>                    cmembercounter(1) = cmembercounter(1) + 1</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                    ckpoint(1:nd,cmembercounter(1)) = point(1:nd,ip)</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                    ckpointindex(cmembercounter(1)) = pointindex(ip)</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>                    cmembercounter(2) = cmembercounter(2) + 1</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                    ckpoint(1:nd,cmembercounter(2)) = point(1:nd,ip)</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                    ckpointindex(cmembercounter(2)) = pointindex(ip)</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>            point = ckpoint           <span class="comment">! Point is now ordered</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            pointindex = ckpointindex <span class="comment">! PointIndex is now ordered</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>            ipstart(1) = 1             ; ipend(1) = cksize(1)</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>            ipstart(2) = cksize(1) + 1 ; ipend(2) = np</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            <span class="keywordflow">do</span> ic = 1,2   <span class="comment">! Get scaled Mahalanobis distances</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                icother = 3 - ic</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                <span class="comment">! get Cholesky Factor of cluster samples</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                <span class="keyword">call </span><a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>  ( nd                                  &amp;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                                    , cksize(ic)                          &amp;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                                    , ckcenter(1:nd,ic)                   &amp;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>                                    , point(1:nd,ipstart(ic):ipend(ic))   &amp;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                                    , ckbecholcov(1:nd,1:nd,ic)           &amp;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>                                    , ckbecholdiag(1:nd,ic)               &amp;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                                    )</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>                <span class="keywordflow">if</span> (ckbecholdiag(1,ic)&lt;0._rk) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>                    <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;    FATAL: runMinVolKernel() @ getSamCholFac() @ getCholeskyFactor() failed.&quot;</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>                    <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;           Cluster id, dimension, size:&quot;</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>                    <span class="keyword">write</span>(*,*) ic, nd, cksize(ic)</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                    stop</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span> </div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                ckbeinvcovmat(1:nd,1:nd,ic) = <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a>( nd, ckbecholcov(1:nd,1:nd,ic), ckbecholdiag(1:nd,ic) )</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                ckmahalsq(1:np,ic) = <a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a>( nd, np, ckcenter(1:nd,ic), ckbeinvcovmat(1:nd,1:nd,ic), point )</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                scalefacsq(ic) = maxval(ckmahalsq(ipstart(ic):ipend(ic),ic))</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>                scalefac(ic) = sqrt( scalefacsq(ic) )</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                ckmahalsq(1:np,ic) = ckmahalsq(1:np,ic) / scalefacsq(ic)</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                ckbevolnormed(ic) = exp( nd*log(scalefac(ic)) + sum(log(ckbecholdiag(1:nd,ic))) - lognormfac ) <span class="comment">! Get the LogVolume of the cluster</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                numpointinck(ic) = cksize(ic) + inclusionfraction*count(ckmahalsq(ipstart(icother):ipend(icother),ic)&lt;1._rk)</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>                ckparvolnormed(ic) = real(numpointinck(ic),kind=rk) * parvolnormed / real(np,kind=rk)</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                blockstabilitycheck: <span class="keywordflow">if</span> (stabilizationrequested) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                    <span class="keywordflow">if</span> ( ckbevolnormed(ic) &gt; ckbevolnormedold(ic) ) <span class="keywordflow">then</span>    <span class="comment">! This is to ensure the convergence of the algorithm</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>          </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                        ckcenter(1:nd,ic) = ckcenterold(1:nd,ic)</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                        ckbecholcov(1:nd,1:nd,ic) = ckbecholcovold(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                        ckbecholdiag(1:nd,ic) = ckbecholdiagold(1:nd,ic)</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                        ckbeinvcovmat(1:nd,1:nd,ic) = ckbeinvcovmatold(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                        scalefacsq(ic) = scalefacsqold(ic)</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                        scalefac(ic) = scalefacold(ic)</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                        ckbevolnormed(ic) = ckbevolnormedold(ic)</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>            </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                        cmembercounter(1) = 0</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                        cmembercounter(2) = cksize(1)</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                        <span class="keywordflow">do</span> ip = 1,np</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                            <span class="keywordflow">if</span> (cmembership(ip)==1) <span class="keywordflow">then</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                                cmembercounter(1) = cmembercounter(1) + 1</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                                ckmahalsq(cmembercounter(1),ic) = ckmahalsqold(ip,ic)</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                                cmembercounter(2) = cmembercounter(2) + 1</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                                ckmahalsq(cmembercounter(2),ic) = ckmahalsqold(ip,ic)</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="keywordflow">                            end if</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span><span class="keywordflow">                        end do</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                        ckmahalsqold(1:np,ic) = ckmahalsq(1:np,ic)</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span> </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                    <span class="keywordflow">else</span>  <span class="comment">! no stability correction is required. Everything just fine...</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                        ckcenterold(1:nd,ic) = ckcenter(1:nd,ic)</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                        ckbecholcovold(1:nd,1:nd,ic) = ckbecholcov(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                        ckbecholdiagold(1:nd,ic) = ckbecholdiag(1:nd,ic)</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                        ckbeinvcovmatold(1:nd,1:nd,ic) = ckbeinvcovmat(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                        ckmahalsqold(1:np,ic) = ckmahalsq(1:np,ic)</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                        scalefacsqold(ic) = scalefacsq(ic)</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                        scalefacold(ic) = scalefac(ic)</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                        ckbevolnormedold(ic) = ckbevolnormed(ic)</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span> </div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span><span class="keywordflow">                    end if</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="keywordflow">                end if</span> blockstabilitycheck</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span> </div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                <span class="comment">!if (CKBEVolNormed(ic)&lt;CKParVolNormed(ic)) then  ! enlarge the bounding ellipsoid</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                <span class="comment">!  !write(*,*) &#39;enlargement happening...&#39;</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                <span class="comment">!  scaleFacSq(ic) = scaleFacSq(ic) * (CKParVolNormed(ic)/CKBEVolNormed(ic))**(2._RK/nd)  ! ATTN: (1._RK/nd) this should likely be (2._RK/nd)</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                <span class="comment">!  scaleFac(ic) = sqrt(scaleFacSq(ic))</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                <span class="comment">!  CKBEVolNormed(ic) = CKParVolNormed(ic)</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                <span class="comment">!end if</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>                debugvolnorm: block</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="keywordtype">                    real</span>(RK) :: dummy</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>                    dummy = real(cksize(ic),kind=rk)*parvolnormed/real(np,kind=rk)</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>                    <span class="keywordflow">if</span> ( ckbevolnormed(ic) &lt; dummy ) <span class="keywordflow">then</span>  <span class="comment">! enlarge the bounding ellipsoid</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>                        <span class="comment">!write(*,*) &#39;enlargement happening...&#39;</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                        scalefacsq(ic) = scalefacsq(ic) * (dummy/ckbevolnormed(ic))**(2._rk/nd)  <span class="comment">! ATTN: (1._RK/nd) this should likely be (2._RK/nd)</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>                        scalefac(ic) = sqrt(scalefacsq(ic))</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>                        ckbevolnormed(ic) = dummy</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span><span class="keywordflow">                    end if</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                <span class="keyword">end </span>block debugvolnorm</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                <span class="comment">!end if blockStabilityCheck</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            <span class="comment">! **********************************************************************************************</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>            <span class="comment">! Reassign points to clusters if needed</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>            mahalsqweight = ( ckbevolnormed / ckparvolnormed )**mahalsqweightexponent</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>            reclusteringneeded = .false.</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            ckcenter(1:nd,1) = ckcenter(1:nd,1) * cksize(1)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>            ckcenter(1:nd,2) = ckcenter(1:nd,2) * cksize(2)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>            ic = 1</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>            icother = 2</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>            <span class="keywordflow">do</span> ip = ipstart(ic),ipend(ic)</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>                cmembership(ip) = ic    <span class="comment">! This has not been assigned correctly in the past, here is the first attempt</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>                <span class="keywordflow">if</span> ( mahalsqweight(ic)*ckmahalsq(ip,ic) &gt;= mahalsqweight(icother)*ckmahalsq(ip,icother) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                    cmembership(ip) = icother</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                    cksize(ic) = cksize(ic) - 1</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                    cksize(icother) = cksize(icother) + 1</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                    ckcenter(1:nd,ic) = ckcenter(1:nd,ic) - point(1:nd,ip)</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                    ckcenter(1:nd,icother) = ckcenter(1:nd,icother) + point(1:nd,ip)</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                    reclusteringneeded = .true.</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>            ic = 2</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>            icother = 1</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>            <span class="keywordflow">do</span> ip = ipstart(ic),ipend(ic)</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                cmembership(ip) = ic    <span class="comment">! This has not been assigned correctly in the past, here is the first attempt</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                <span class="keywordflow">if</span> ( mahalsqweight(ic)*ckmahalsq(ip,ic) &gt; mahalsqweight(icother)*ckmahalsq(ip,icother) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                    cmembership(ip) = icother</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                    cksize(ic) = cksize(ic) - 1</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                    cksize(icother) = cksize(icother) + 1</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                    ckcenter(1:nd,ic) = ckcenter(1:nd,ic) - point(1:nd,ip)</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                    ckcenter(1:nd,icother) = ckcenter(1:nd,icother) + point(1:nd,ip)</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                    reclusteringneeded = .true.</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>            blockreclusteringneeded: <span class="keywordflow">if</span> (reclusteringneeded) <span class="keywordflow">then</span>  <span class="comment">! perform reassignment</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                blockillegalclustersize: <span class="keywordflow">if</span> ( any(cksize&lt;minclustersize) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                    minvolfailurecounter = minvolfailurecounter + 1</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                    <span class="keywordflow">if</span> (minvolfailurecounter&gt;maxallowedminvolfailure) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                        ncoptimal = 1</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                        cmembership = 1</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                        csize(1) = np</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                        convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>                        <span class="comment">!debugMinVolFailureCounter: block</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                        <span class="comment">!  write(*,*) &#39;minVolFailureCounter: &#39;, minVolFailureCounter</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>                        <span class="comment">!end block debugMinVolFailureCounter</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>                        <span class="keywordflow">return</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span><span class="keywordflow">                    end if</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>                    kmeansfailurecounter = 0</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>                    looprunkmeans: <span class="keywordflow">do</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                        <span class="keyword">call </span>runkmeans(.true.,2,nd,np,point,ckcenter,cksize,cmembership,iteration,zcsiteration)</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                        <span class="keywordflow">if</span> ( any(cksize&lt;minclustersize) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>                            kmeansfailurecounter = kmeansfailurecounter + 1</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>                            <span class="keywordflow">if</span> (kmeansfailurecounter&gt;maxallowedkmeansfailure) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>                                ncoptimal = 1</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>                                cmembership = 1</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                                csize(1) = np</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                                convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>                                <span class="comment">!debugKmeansFailureCounter: block</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>                                <span class="comment">!  write(*,*) &#39;kmeansFailureCounter: &#39;, kmeansFailureCounter</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                                <span class="comment">!end block debugKmeansFailureCounter</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>                                <span class="keywordflow">return</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="keywordflow">                            end if</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>                            cycle looprunkmeans</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="keywordflow">                        end if</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                        <span class="keywordflow">exit</span> looprunkmeans</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><span class="keywordflow">                    end do</span> looprunkmeans</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span> </div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                    ckbevolnormedold = huge(0._rk)</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                    cycle looprecursiverunminvolkernel</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="keywordflow">                end if</span> blockillegalclustersize</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>                ckcenter(1:nd,1) = ckcenter(1:nd,1) / cksize(1)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>                ckcenter(1:nd,2) = ckcenter(1:nd,2) / cksize(2)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>                cycle looprecursiverunminvolkernel</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="keywordflow">            end if</span> blockreclusteringneeded</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span> </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>            ckcenter(1:nd,1) = ckcenter(1:nd,1) / cksize(1)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>            ckcenter(1:nd,2) = ckcenter(1:nd,2) / cksize(2)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>            <span class="keywordflow">exit</span> looprecursiverunminvolkernel</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span> </div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="keywordflow">        end do</span> looprecursiverunminvolkernel</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        <span class="comment">!***************************************************************************************************************************</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        <span class="comment">!***************************************************************************************************************************</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span> </div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        furtherclusteringcheck: <span class="keywordflow">if</span> (sum(ckbevolnormed)&lt;cbevolnormed(1) .or. cbevolnormed(1)&gt;tightness*parvolnormed) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            <span class="comment">! at least two clusters is better than one. now search for more child clusters</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            ckncmax(1) = max( cksize(1)/(ndeffective+1) , 1 )</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>            ckncmax(2) = max( cksize(2)/(ndeffective+1) , 1 )</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>            ipstart(1) = 1             ; ipend(1) = cksize(1)</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            ipstart(2) = cksize(1) + 1 ; ipend(2) = np</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span> </div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            <span class="keywordflow">do</span> ic = 1,2   <span class="comment">! Search for more grand-child clusters</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                <span class="keywordflow">if</span> (ic==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                    icstart = 1</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>                    icend = ckncmax(1)</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                    icstart = ckncoptimal(1) + 1</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                    icend = ckncoptimal(1) + ckncmax(2)</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                cbevolnormed(icstart) = ckbevolnormed(ic)</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                <span class="keywordflow">if</span> (ckncmax(ic)&gt;1) <span class="keywordflow">then</span> <span class="comment">! .and. CKBEVolNormed(ic)&gt;1.1_RK*CKParVolNormed(ic)) then</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                    <span class="keyword">call </span>runminvolkernel( ckncmax(ic), nd, cksize(ic)               &amp;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                                        , stabilizationrequested                    &amp;</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>                                        , maxkvolumelooprecursion                   &amp;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>                                        , maxallowedkmeansfailure                   &amp;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>                                        , maxallowedminvolfailure                   &amp;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>                                        , mahalsqweightexponent                     &amp;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>                                        , tightness                                 &amp;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>                                        , inclusionfraction                         &amp;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>                                        , ckparvolnormed(ic)                        &amp;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                                        , lognormfac                                &amp;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>                                        , point(1:nd,ipstart(ic):ipend(ic))         &amp;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                                        , ckncoptimal(ic)                           &amp;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                                        , ccenter(1:nd,icstart:icend)               &amp;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                                        , csize(icstart:icend)                      &amp;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                                        , cbeinvcovmat(1:nd,1:nd,icstart:icend)     &amp;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                                        , cbecholcov(1:nd,1:nd,icstart:icend)       &amp;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                                        , cbecholdiag(1:nd,icstart:icend)           &amp;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                                        , cbevolnormed(icstart:icend)               &amp;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>                                        , cmembership(ipstart(ic):ipend(ic))        &amp;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>                                        , pointindex(ipstart(ic):ipend(ic))         &amp;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>                                        , convergencefailurecounter                 &amp;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>                                        )</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>                    <span class="keywordflow">if</span> (ic==2) cmembership(ipstart(ic):ipend(ic)) = cmembership(ipstart(ic):ipend(ic)) + icstart - 1</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                    ckncoptimal(ic)=1</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>                <span class="keywordflow">if</span> ( ckncoptimal(ic)==1 .or. ckncmax(ic)==1 ) <span class="keywordflow">then</span> <span class="comment">! There is only one cluster here</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>                    ckncoptimal(ic) = 1</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>                    ccenter(1:nd,icstart) = ckcenter(1:nd,ic)</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>                    csize(icstart) = cksize(ic)</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>                    cbeinvcovmat(1:nd,1:nd,icstart) = ckbeinvcovmat(1:nd,1:nd,ic) / scalefacsq(ic)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>                    cbecholcov(1:nd,1:nd,icstart) = ckbecholcov(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>                    cbecholdiag(1:nd,icstart) = ckbecholdiag(1:nd,ic)</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>                    <span class="comment">! Now rescale Cholesky factor and its diagonals, such that they describe the bounding ellipsoid of the cluster</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>                    <span class="keywordflow">do</span> j = 1,nd-1</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>                        cbecholdiag(j,icstart) = cbecholdiag(j,icstart) * scalefac(ic)</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>                        <span class="keywordflow">do</span> i = j+1,nd</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>                            cbecholcov(i,j,icstart) = cbecholcov(i,j,icstart) * scalefac(ic)</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="keywordflow">                        end do</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="keywordflow">                    end do</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>                    cbecholdiag(nd,icstart) = cbecholdiag(nd,icstart) * scalefac(ic)</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>            ncoptimal = sum(ckncoptimal)</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span> </div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>        <span class="keywordflow">else</span> furtherclusteringcheck  <span class="comment">! one cluster is better</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>            ncoptimal = 1</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>            cmembership = 1</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>            csize(1) = np</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="keywordflow">        end if</span> furtherclusteringcheck</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>        <span class="comment">!write(*,*) &#39;ncMax: &#39;, ncMax</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>        <span class="comment">!write(*,*) &#39;ncOptimal: &#39;, ncOptimal</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>        <span class="comment">!write(*,*) &#39;CSize: &#39;, CSize(1:ncOptimal)</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>        <span class="comment">!write(*,*) &#39;CCenter: &#39;, CCenter(:,1:ncOptimal)</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        <span class="comment">!write(*,*) &#39;Membership: &#39;, CMembership(:)</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <span class="comment">!read(*,*)</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="keyword">end subroutine </span>runminvolkernel</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="keyword">end </span>submodule MinVolPartition</div>
<div class="ttc" id="ainterfacestatistics__mod_1_1getmahalsq_html"><div class="ttname"><a href="interfacestatistics__mod_1_1getmahalsq.html">statistics_mod::getmahalsq</a></div><div class="ttdef"><b>Definition:</b> <a href="Statistics__mod_8f90_source.html#l00149">Statistics_mod.f90:149</a></div></div>
<div class="ttc" id="anamespaceclassification_html"><div class="ttname"><a href="namespaceclassification.html">classification</a></div><div class="ttdef"><b>Definition:</b> <a href="______toBeCleared_______2Classification__mod_8f90_source.html#l00001">Classification_mod.f90:1</a></div></div>
<div class="ttc" id="anamespacematrix__mod_html"><div class="ttname"><a href="namespacematrix__mod.html">matrix_mod</a></div><div class="ttdoc">This module contains mathematical procedures.</div><div class="ttdef"><b>Definition:</b> <a href="Matrix__mod_8f90_source.html#l00046">Matrix_mod.f90:46</a></div></div>
<div class="ttc" id="anamespacematrix__mod_html_a1281fcb5ff0398b841570144bf8765fd"><div class="ttname"><a href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">matrix_mod::getinvmatfromcholfac</a></div><div class="ttdeci">pure real(rk) function, dimension(nd, nd) getinvmatfromcholfac(nd, CholeskyLower, CholeskyDiago)</div><div class="ttdoc">Return the inverse matrix of a symmetric-positive-definite matrix, whose Cholesky Lower triangle is g...</div><div class="ttdef"><b>Definition:</b> <a href="Matrix__mod_8f90_source.html#l00247">Matrix_mod.f90:248</a></div></div>
<div class="ttc" id="anamespacestatistics__mod_html"><div class="ttname"><a href="namespacestatistics__mod.html">statistics_mod</a></div><div class="ttdoc">This module contains the classes and procedures for various statistical computations.</div><div class="ttdef"><b>Definition:</b> <a href="Statistics__mod_8f90_source.html#l00046">Statistics_mod.f90:46</a></div></div>
<div class="ttc" id="anamespacestatistics__mod_html_ae321c1cfb8f2d0f3e4980b2fa12dbde1"><div class="ttname"><a href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">statistics_mod::getsamcholfac</a></div><div class="ttdeci">subroutine getsamcholfac(nd, np, Mean, Point, CholeskyLower, CholeskyDiago)</div><div class="ttdoc">Return the lower triangle Cholesky Factor of the covariance matrix of a set of points in the lower pa...</div><div class="ttdef"><b>Definition:</b> <a href="Statistics__mod_8f90_source.html#l00998">Statistics_mod.f90:999</a></div></div>
</div><!-- fragment --></div><!-- contents -->
    <!-- start footer part -->
    <hr class="footer"/>
    <div style="text-align:center">
        <p>
            <a href="https://www.cdslab.org/paramonte"><b>ParaMonte: Plain Powerful Parallel Monte Carlo Library</b></a>&nbsp;
            &copy; Copyright 2020, <a href="https://www.cdslab.org" target="_blank"><b>The Computational Data Science Lab</b></a>
            <br/>
        </p>
    </div>
    <address class="footer">
        <small>
            Generated on Thu Aug 19 2021 18:26:39 for ParaMonte by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a>
            <!--
            1.9.2
            -->
        </small>
    </address>
    <!-- Start of statc -->
    <div style="color: #ffffff; float: none; width: 100%;">
        <span style="font-size:0.8em">
        <!--visitor count: -->
            <script type="text/javascript">
                var sc_project=12178963; 
                var sc_invisible=1; 
                var sc_security="e0dfe0f9"; 
                var sc_text=3; 
                var scJsHost = "https://";
                document.write("<sc"+"ript type='text/javascript' src='" +
                scJsHost+
                "statcounter.com/counter/counter.js'></"+"script>");
            </script>
        </span>
    </div>
</body>
</html>
