<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParaMonte: D:/Dropbox/Projects/20180101_ParaMonte/git/src/kernel/MinVolPartition_mod.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="html_extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="https://www.cdslab.org/paramonte/" target="_blank"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParaMonte
   &#160;<span id="projectnumber">1.5.1</span>
   </div>
   <div id="projectbrief">Plain Powerful Parallel Monte Carlo Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">MinVolPartition_mod.f90</div></div>
</div><!--header-->
<div class="contents">
<a href="MinVolPartition__mod_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">!!!!   MIT License</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">!!!!   ParaMonte: plain powerful parallel Monte Carlo library.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">!!!!   Copyright (C) 2012-present, The Computational Data Science Lab</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">!!!!   This file is part of the ParaMonte library.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">!!!!   Permission is hereby granted, free of charge, to any person obtaining a</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">!!!!   copy of this software and associated documentation files (the &quot;Software&quot;),</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">!!!!   to deal in the Software without restriction, including without limitation</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">!!!!   the rights to use, copy, modify, merge, publish, distribute, sublicense,</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">!!!!   and/or sell copies of the Software, and to permit persons to whom the</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">!!!!   Software is furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">!!!!   The above copyright notice and this permission notice shall be</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">!!!!   included in all copies or substantial portions of the Software.</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">!!!!   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">!!!!   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">!!!!   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">!!!!   IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">!!!!   DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment">!!!!   OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">!!!!   OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">!!!!   ACKNOWLEDGMENT</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">!!!!   ParaMonte is an honor-ware and its currency is acknowledgment and citations.</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">!!!!   As per the ParaMonte library license agreement terms, if you use any parts of</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment">!!!!   this library for any purposes, kindly acknowledge the use of ParaMonte in your</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment">!!!!   work (education/research/industry/development/...) by citing the ParaMonte</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment">!!!!   library as described on this page:</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="comment">!!!!       https://github.com/cdslaborg/paramonte/blob/main/ACKNOWLEDGMENT.md</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="comment">!!!!</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno"><a class="line" href="namespaceminvolpartition__mod.html">   48</a></span><span class="keyword">module</span> <a class="code hl_namespace" href="namespaceminvolpartition__mod.html">minvolpartition_mod</a></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceconstants__mod.html">constants_mod</a>, <span class="keywordtype">only</span>: ik, rk</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceerr__mod.html">err_mod</a>, <span class="keywordtype">only</span>: <a class="code hl_struct" href="structerr__mod_1_1err__type.html">err_type</a></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="namespaceminvolpartition__mod.html#acfc91d3e6720662967db55d25e5195f8">   55</a></span>    <span class="keywordtype">character(*)</span>, <span class="keywordtype">parameter</span> :: <a class="code hl_variable" href="namespaceconstants__mod.html#a7facbdd6f237b77f9c08c94fbe98e847">module_name</a> = <span class="stringliteral">&quot;@MinVolPartition_mod&quot;</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html">   58</a></span>    <span class="keyword">type</span> :: <a class="code hl_struct" href="structminvolpartition__mod_1_1minvolpartition__type.html">minvolpartition_type</a></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        <span class="comment">!type(Ellipsoid_type)        :: Backup</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#af991c27a0123a4dd51af0ed4db68f56c">   60</a></span>        <span class="keywordtype">integer(IK)</span>                 :: neoptimal</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#ad9b444c760ef0fc4ef2fd5db0f8f19ee">   61</a></span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">allocatable</span>   :: membership(:)</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#ad5b5a917b71d078257e995fa55a4f113">   62</a></span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">allocatable</span>   :: pointindex(:)</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#ab08d85130ff60411f56a72a64aa5346e">   63</a></span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">allocatable</span>   :: size(:)</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#acfb5a584815acc86804cd851be5537dd">   64</a></span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">allocatable</span>   :: ellindex(:)</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#a43c712d5b4a29bf44ac0be737b2c8c91">   65</a></span><span class="keywordtype">        real</span>(rk)    , <span class="keywordtype">allocatable</span>   :: center(:,:)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#a9860831e2d231bc81b130b3f99fd76ab">   66</a></span><span class="keywordtype">        real</span>(rk)    , <span class="keywordtype">allocatable</span>   :: logvolnormed(:)</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#a7cb04698c2a3fb8d79cc953923da4fba">   67</a></span><span class="keywordtype">        real</span>(rk)    , <span class="keywordtype">allocatable</span>   :: invcovmat(:,:,:)</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#a84ed97c92d63f6e4855293093bb6a074">   68</a></span><span class="keywordtype">        real</span>(rk)    , <span class="keywordtype">allocatable</span>   :: choldiaglower(:,:,:)</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno"><a class="line" href="structminvolpartition__mod_1_1minvolpartition__type.html#a12370526e66144be8b13dca56b9a7414">   70</a></span>        <span class="keywordtype">type</span>(<a class="code hl_struct" href="structerr__mod_1_1err__type.html">err_type</a>)              :: err</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="keyword">end type </span><a class="code hl_struct" href="structminvolpartition__mod_1_1minvolpartition__type.html">minvolpartition_type</a></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="keyword">contains</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="namespaceminvolpartition__mod.html#a82a4bdaa5cd0b54252e4b6d47b1dc2bb">   79</a></span>    <span class="keyword">subroutine </span><a class="code hl_function" href="namespaceminvolpartition__mod.html#a82a4bdaa5cd0b54252e4b6d47b1dc2bb">runminvolpartition</a>   ( ncMax, nd, np &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>                                    , maxKvolumeLoopRecursion &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>                                    , maxAllowedKmeansFailure &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>                                    , maxAllowedMinVolFailure &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>                                    , stabilizationRequested &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>                                    , mahalSqWeightExponent &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>                                    , tightness &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>                                    , inclusionFraction &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>                                    , parLogVol &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>                                    ! inout</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                                    , Point &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                                    ! output</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                                    , ncOptimal &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                                    , CCenter &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                                    , CSize &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                                    , CBEInvCovMat &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                                    , CBECholCov &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                                    , CBECholDiag &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                                    , CBEVolNormed &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                                    , CMembership &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                                    , PointIndex &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                                    , convergenceFailureCounter &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                                    )</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacestatistics__mod.html">statistics_mod</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>, <a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacematrix__mod.html">matrix_mod</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">intent(in)</span>    :: ncMax,nd,np                 <span class="comment">! maximum number of clusters, number of dimensions, number of points</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">intent(in)</span>    :: maxKvolumeLoopRecursion</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">intent(in)</span>    :: maxAllowedKmeansFailure</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        <span class="keywordtype">integer(IK)</span> , <span class="keywordtype">intent(in)</span>    :: maxAllowedMinVolFailure</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        <span class="keywordtype">logical</span>     , <span class="keywordtype">intent(in)</span>    :: stabilizationRequested</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(in)</span>    :: mahalSqWeightExponent</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(in)</span>    :: tightness                    <span class="comment">! the factor deremining how large the bounding ellipsoid can be, compared to the true volume of the ellipsoid.</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(in)</span>    :: inclusionFraction            <span class="comment">! the fraction of non-cluster-member points that ARE inside the cluster, to be considered in the estimation of the true volume of the cluster.</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(in)</span>    :: parLogVol                    <span class="comment">! input log-estimate of the total volume of the points.</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(inout)</span> :: Point(nd,np)                 <span class="comment">! the input data (points) to be clustered. on output, it is ordered.</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(out)</span>   :: CCenter(nd,ncMax)            <span class="comment">! Centers of the clusters (nd,ncMax)</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(out)</span>   :: CBEInvCovMat(nd,nd,ncMax)    <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: Full symmetric Inverse Covariance Matrices of the Bounding Ellipsoids of all clusters.</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(out)</span>   :: CBECholCov(nd,nd,ncMax)      <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: The lower triangle contains the Cholesky factor of the covariance matrix of the input points, the upper triangle maybe the CovMat itself (not needed). On output contains in the lower triangle, the Cholesky factor of all clusters found.</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(out)</span>   :: CBECholDiag(nd,ncMax)        <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: The diagonal elements of the Cholesky factor of the covariance matrix of the input points, on output, contains the cholesky factor of all found clusters.</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="keywordtype">        real</span>(RK)    , <span class="keywordtype">intent(out)</span>   :: CBEVolNormed(ncMax)          <span class="comment">! CBE: Cluster Bounding Ellipsoid - On output: Each element of the array contains the volume of the corresponding Cluster Bounding Ellipsoid.</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        <span class="keywordtype">integer</span>     , <span class="keywordtype">intent(out)</span>   :: ncOptimal                    <span class="comment">! this variable is saved throughout recursive iterations of subroutine</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        <span class="keywordtype">integer</span>     , <span class="keywordtype">intent(out)</span>   :: CSize(ncMax)                 <span class="comment">! cluster sizes (nCMax)</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="keywordtype">integer</span>     , <span class="keywordtype">intent(out)</span>   :: CMembership(np)              <span class="comment">! the CMembership id of each point (representing the cluster number to which the point belongs)</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        <span class="keywordtype">integer</span>     , <span class="keywordtype">intent(out)</span>   :: PointIndex(np)               <span class="comment">! Vector containing the scrambled indices of Point elements. It represent the mapping from the input Point elements to output scrambled Point vector.</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        <span class="keywordtype">integer</span>     , <span class="keywordtype">intent(inout)</span> :: convergenceFailureCounter    <span class="comment">! number of times the algorithm failed to converge.</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        <span class="keywordtype">integer</span>                     :: i,j</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="keywordtype">        real</span>(RK)                    :: parVolNormed                 <span class="comment">! LogVolume of parent ellipsoid</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="keywordtype">        real</span>(RK)                    :: logNormFac, scaleFac</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>        <span class="comment">!ncMax = np/(nd+1)</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        ccenter(1:nd,1) = 0._rk</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        <span class="keywordflow">do</span> j = 1,np</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>          ccenter(1:nd,1) = ccenter(1:nd,1) + point(1:nd,j)</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>          pointindex(j) = j</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="keywordflow">        end do</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        ccenter(1:nd,1) = ccenter(1:nd,1) / real(np,kind=rk)</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        <span class="keyword">call </span><a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>( nd, np, ccenter(1:nd,1), point, cbecholcov(1:nd,1:nd,1), cbecholdiag(1:nd,1) )   <span class="comment">! get Cholesky Factor of cluster samples</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <span class="keywordflow">if</span> (cbecholdiag(1,1)&lt;0._rk) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;getCholeskyFactor() failed in getSamCholFac() in runMinVolPartition()&#39;</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>            <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Max cluster number, dimension, total points:&#39;</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>            <span class="keyword">write</span>(*,*) ncmax, nd, np</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            stop</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        cbeinvcovmat(1:nd,1:nd,1) = <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a>(nd,cbecholcov(1:nd,1:nd,1),cbecholdiag(1:nd,1))</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        scalefac = sqrt( maxval(<a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a>(nd, np, ccenter(1:nd,1), cbeinvcovmat(1:nd,1:nd,1), point)) )</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        cbevolnormed(1) = sum(log(cbecholdiag(1:nd,1))) + nd*log(scalefac)   <span class="comment">! Get the LogVolume of the first cluster. This will be used to normalize the volumes of all child clusters.</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordflow">if</span> (cbevolnormed(1)&gt;parlogvol) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>            lognormfac = cbevolnormed(1)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>            cbevolnormed(1) = 1._rk</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>            parvolnormed = exp( parlogvol - lognormfac )</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        <span class="keywordflow">else</span>    <span class="comment">! enlarge the bounding ellipsoid</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>            <span class="comment">!write(*,*) &#39;no no no no!&#39;</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            lognormfac = parlogvol</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <span class="comment">!scaleFac = scaleFac * exp( 0.5_RK*(logNormFac-CBEVolNormed(1))/nd )</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            scalefac = scalefac * exp( (lognormfac-cbevolnormed(1))/nd )</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>            cbevolnormed(1) = 1._rk</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>            parvolnormed = 1._rk</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <span class="keywordflow">if</span> (ncmax &gt; 1 .and. cbevolnormed(1)&gt;tightness*parvolnormed) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <span class="comment">!convergenceFailureCounter = 0</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>            <span class="keyword">call </span><a class="code hl_function" href="namespaceminvolpartition__mod.html#ae2644d3f5cfc00e7e7e10015da6ac603">runminvolkernel</a>( ncmax = ncmax &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                                , nd = nd &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>                                , np = np &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>                                , stabilizationrequested = stabilizationrequested &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                                , maxkvolumelooprecursion = maxkvolumelooprecursion &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                                , maxallowedkmeansfailure = maxallowedkmeansfailure &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                                , maxallowedminvolfailure = maxallowedminvolfailure &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                                , mahalsqweightexponent = mahalsqweightexponent &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                                , tightness = tightness &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                                , inclusionfraction = inclusionfraction &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                                , parvolnormed = parvolnormed &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                                , lognormfac = lognormfac &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                                , point = point &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                                , ncoptimal = ncoptimal &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                                , ccenter = ccenter &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                                , csize = csize &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                                , cbeinvcovmat = cbeinvcovmat &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                                , cbecholcov = cbecholcov &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                                , cbecholdiag = cbecholdiag &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                                , cbevolnormed = cbevolnormed &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                                , cmembership = cmembership &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>                                , pointindex = pointindex &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>                                , convergencefailurecounter = convergencefailurecounter &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>                                )</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="keywordflow">else</span> <span class="comment">! There is only one cluster</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>            ncoptimal = 1</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        <span class="keywordflow">if</span> (ncoptimal==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>            <span class="keywordflow">do</span> j = 1,nd-1 <span class="comment">! Now rescale Cholesky factor and its diagonals, such that they describe the bounding ellipsoid of the cluster</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                cbecholdiag(j,1) = cbecholdiag(j,1) * scalefac</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                <span class="keywordflow">do</span> i = j+1,nd</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>                    cbecholcov(i,j,1) = cbecholcov(i,j,1) * scalefac</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="keywordflow">                end do</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>            cbecholdiag(nd,1) = cbecholdiag(nd,1) * scalefac</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>            cbeinvcovmat(1:nd,1:nd,1) = cbeinvcovmat(1:nd,1:nd,1) / scalefac**2</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keyword">end subroutine </span><a class="code hl_function" href="namespaceminvolpartition__mod.html#a82a4bdaa5cd0b54252e4b6d47b1dc2bb">runminvolpartition</a></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="comment">! This code assumes that ncMax &gt; 1 on input.</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="comment">! important input requirements:</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno"><a class="line" href="namespaceminvolpartition__mod.html#ae2644d3f5cfc00e7e7e10015da6ac603">  207</a></span>    <span class="keywordtype">recursive</span> <span class="keyword">subroutine </span><a class="code hl_function" href="namespaceminvolpartition__mod.html#ae2644d3f5cfc00e7e7e10015da6ac603">runminvolkernel</a>( ncMax &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>                                        , nd &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                                        , np &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>                                        , stabilizationRequested &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>                                        , maxKvolumeLoopRecursion &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                                        , maxAllowedKmeansFailure &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                                        , maxAllowedMinVolFailure &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>                                        , mahalSqWeightExponent &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>                                        , tightness &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>                                        , inclusionFraction &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>                                        , parVolNormed &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>                                        , logNormFac &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                                        , Point &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                                        , ncOptimal &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                                        , CCenter &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                                        , CSize &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                                        , CBEInvCovMat &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                                        , CBECholCov &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                                        , CBECholDiag &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                                        , CBEVolNormed &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                                        , CMembership &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                                        , PointIndex &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                                        , convergenceFailureCounter &amp; ! LCOV_EXCL_LINE</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                                        )</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacestatistics__mod.html">statistics_mod</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>, <a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacematrix__mod.html">matrix_mod</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacekmeans__mod.html">kmeans_mod</a>, <span class="keywordtype">only</span>: <a class="code hl_function" href="namespacekmeans__mod.html#a217c43a3940ffade09cf8f2a1fcd9837">runkmeans</a></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceerr__mod.html">err_mod</a>, <span class="keywordtype">only</span>:  <a class="code hl_struct" href="structerr__mod_1_1err__type.html">err_type</a></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">save</span>          :: ncall = 0</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: ncmax                             <span class="comment">! maximum number of clusters determined from the nd and np</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: nd,np                             <span class="comment">! number of dimensions, number of points</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        <span class="keywordtype">logical</span> , <span class="keywordtype">intent(in)</span>    :: stabilizationrequested</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxkvolumelooprecursion</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxallowedkmeansfailure</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(in)</span>    :: maxallowedminvolfailure</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(in)</span>    :: mahalsqweightexponent</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(in)</span>    :: tightness                         <span class="comment">! the factor deremining how large the bounding ellipsoid can be, compared to the true volume of the ellipsoid.</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(in)</span>    :: inclusionfraction                 <span class="comment">! the fraction of non-cluster-member points that ARE inside the cluster, to be considered in the estimation of the true volume of the cluster.</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(in)</span>    :: parvolnormed                      <span class="comment">! parent&#39;s sqrt(det(invCovMat)), where invCovMat is the inverse covariance matrix of the bounding ellipsoid of the input points.</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(in)</span>    :: lognormfac                        <span class="comment">! parent&#39;s sqrt(det(invCovMat)), where invCovMat is the inverse covariance matrix of the bounding ellipsoid of the input points.</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: ncoptimal                         <span class="comment">! this variable is saved throughout recursive iterations of subroutine</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(out)</span>   :: csize(ncmax)                      <span class="comment">! cluster sizes (nCMax)</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: convergencefailurecounter         <span class="comment">! returns the number of times the algorithm failed to converge.</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: cmembership(np)                   <span class="comment">! the CMembership id of each point (representing the cluster number to which the point belongs)</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        <span class="keywordtype">integer</span> , <span class="keywordtype">intent(inout)</span> :: pointindex(np)                    <span class="comment">! Vector containing the scrambled indices of Point elements. It represent the mapping from the input Point elements to output scrambled Point vector.</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(inout)</span> :: point(nd,np)                      <span class="comment">! the input data (points) to be clustered.</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(inout)</span> :: ccenter(nd,ncmax)                 <span class="comment">! Centers of the clusters (nd,ncMax)</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(inout)</span> :: cbecholcov(nd,nd,ncmax)           <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The lower triangle contains the Cholesky factor of the covariance matrix of the input points, the upper triangle maybe the CovMat itself (not needed). On output contains in the lower triangle, the Cholesky factor of all clusters found.</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(inout)</span> :: cbeinvcovmat(nd,nd,ncmax)         <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The lower triangle contains the Cholesky factor of the covariance matrix of the input points, the upper triangle maybe the CovMat itself (not needed). On output contains in the lower triangle, the Cholesky factor of all clusters found.</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(inout)</span> :: cbecholdiag(nd,ncmax)             <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The diagonal elements of the Cholesky factor of the covariance matrix of the input points, on output, contains the cholesky factor of all found clusters.</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="keywordtype">        real</span>(rk), <span class="keywordtype">intent(inout)</span> :: cbevolnormed(ncmax)               <span class="comment">! CBE: Cluster Bounding Ellipsoid - On input: The volume of the Bounding Ellipsoid of the parent cluster. On output: The Bounding volume of all child clusters.</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span><span class="keywordtype">        real</span>(rk)                :: ckcenter(nd,2)                    <span class="comment">! Cluster Centers for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span><span class="keywordtype">        real</span>(rk)                :: ckbecholcov(nd,nd,2)              <span class="comment">! Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters, reported in the upper triangle. The lower triangle contains the Cholesky factors</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span><span class="keywordtype">        real</span>(rk)                :: ckbeinvcovmat(nd,nd,2)            <span class="comment">! Inverse of the Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="keywordtype">        real</span>(rk)                :: ckbecholdiag(nd,2)                <span class="comment">! determinants of the inverse covariance matrices of the bounding ellipsoids of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span><span class="keywordtype">        real</span>(rk)                :: ckmahalsq(np,2)                   <span class="comment">! Vector of Maximum Mahalanobis distances for each cluster</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span><span class="keywordtype">        real</span>(rk)                :: ckbevolnormed(2)                  <span class="comment">! New Cluster Bounding Ellisoid Volumes</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span><span class="keywordtype">        real</span>(rk)                :: ckparvolnormed(2)                 <span class="comment">! New Cluster Volume estimates</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="keywordtype">        real</span>(rk)                :: scalefacsq(2),scalefac(2)         <span class="comment">! The factor by which determinant must be multiplied in order for the ellipsoid to become a bounding ellipsoid.</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="keywordtype">        real</span>(rk)                :: ckpoint(nd,np)                    <span class="comment">! Cluster Points in 2-means partition result</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="keywordtype">        real</span>(rk)                :: mahalsqweight(2)                  <span class="comment">! MahalSqWeight definition of Lu et al 2007</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        <span class="keywordtype">integer</span>                 :: ckpointindex(np)                  <span class="comment">! Vector containing the scrambled indices of Point elements. It represent the mapping from the input Point elements to output scrambled Point vector.</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        <span class="keywordtype">integer</span>                 :: cksize(2)                         <span class="comment">! cluster sizes for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        <span class="keywordtype">integer</span>                 :: numpointinck(2)                   <span class="comment">! cluster sizes for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>        <span class="keywordtype">integer</span>                 :: cksizedummy(2)                    <span class="comment">! cluster sizes for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        <span class="keywordtype">integer</span>                 :: ckncmax(2)                        <span class="comment">! maximum allowed number of clusters in each of the two K-means clusters.</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        <span class="keywordtype">integer</span>                 :: ckncoptimal(2)                    <span class="comment">! optimal number of clusters in each of the child clusters</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        <span class="keywordtype">integer</span>                 :: cmembercounter(2)                 <span class="comment">! cluster member counter</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>        <span class="keywordtype">integer</span>                 :: zcsiteration                      <span class="comment">! Counts the number of times zero sized clusters are found, zcs stands for zero cluster size</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>        <span class="keywordtype">integer</span>                 :: ipstart(2),ipend(2)</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>        <span class="keywordtype">integer</span>                 :: i,j,ip,ic,icother,iteration,ndeffective</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        <span class="keywordtype">integer</span>                 :: icstart,icend,recursioncounter,kmeansfailurecounter,minvolfailurecounter</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        <span class="keywordtype">logical</span>                 :: reclusteringneeded</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        <span class="keywordtype">integer</span>                 :: minclustersize</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="comment">! stabilization variables:</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="keywordtype">        real</span>(rk)                :: ckcenterold(nd,2)            <span class="comment">! Cluster Centers for nc=2 Kmeans algorithm</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="keywordtype">        real</span>(rk)                :: ckbecholcovold(nd,nd,2)      <span class="comment">! Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters, reported in the upper triangle. The lower triangle contains the Cholesky factors</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="keywordtype">        real</span>(rk)                :: ckbeinvcovmatold(nd,nd,2)    <span class="comment">! Inverse of the Covariance Matrices of the bounding ellipsoid of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="keywordtype">        real</span>(rk)                :: ckbecholdiagold(nd,2)        <span class="comment">! determinants of the inverse covariance matrices of the bounding ellipsoids of the Kmeans&#39; 2 clusters.</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="keywordtype">        real</span>(rk)                :: cknormedpoint(nd,np,2)       <span class="comment">! Vector of Maximum Mahalanobis distances for each cluster</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="keywordtype">        real</span>(rk)                :: ckmindistancesq(np)          <span class="comment">! Vector of Maximum Mahalanobis distances for each cluster</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="keywordtype">        real</span>(rk)                :: ckmahalsqold(np,2)           <span class="comment">! Vector of Maximum Mahalanobis distances for each cluster</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span><span class="keywordtype">        real</span>(rk)                :: ckbevolnormedold(2)          <span class="comment">! New Cluster Bounding Ellisoid Volumes</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="keywordtype">        real</span>(rk)                :: scalefacsqold(2)             <span class="comment">! The factor by which determinant must be multiplied in order for the ellipsoid to become a bounding ellipsoid.</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="keywordtype">        real</span>(rk)                :: scalefacold(2)               <span class="comment">! The factor by which determinant must be multiplied in order for the ellipsoid to become a bounding ellipsoid.</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="keywordtype">        real</span>(rk)                :: potential                    <span class="comment">! The factor by which determinant must be multiplied in order for the ellipsoid to become a bounding ellipsoid.</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="keywordtype">type</span>(<a class="code hl_struct" href="structerr__mod_1_1err__type.html">err_type</a>)          :: err</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        minclustersize = nd + 1</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        ndeffective = np / ncmax + 1</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>        ncall = ncall + 1</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        kmeansfailurecounter = 0</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        looprunkmeans: <span class="keywordflow">do</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="keyword">call </span><a class="code hl_function" href="namespacekmeans__mod.html#a217c43a3940ffade09cf8f2a1fcd9837">runkmeans</a>  ( nd = nd &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                            , np = np &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                            , nc = 2_ik &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                            , point = point &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                            , <span class="keyword">Size</span> = cksize &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                            , center = ckcenter &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                            , membership = cmembership &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                            , normedpoint = cknormedpoint &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                            , mindistancesq = ckmindistancesq &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                            , potential = potential &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                            , niter = iteration &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                            , nzsci = zcsiteration &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                            , err = err &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                            <span class="comment">!, niterMax &amp; ! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                            <span class="comment">!, nzsciMax &amp; ! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                            <span class="comment">!, relTol &amp; ! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                            )</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            <span class="keywordflow">if</span> ( any(cksize&lt;minclustersize) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                kmeansfailurecounter = kmeansfailurecounter + 1</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                <span class="keywordflow">if</span> (kmeansfailurecounter&gt;maxallowedkmeansfailure) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                    ncoptimal = 1</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                    cmembership = 1</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                    csize(1) = np</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                    convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                    <span class="keywordflow">return</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>                cycle looprunkmeans</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="keywordflow">            end if</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>            <span class="keywordflow">exit</span> looprunkmeans</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="keywordflow">        end do</span> looprunkmeans</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>        ckbevolnormedold = huge(0._rk)</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        recursioncounter = 0</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>        minvolfailurecounter = 0</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>        looprecursiverunminvolkernel: <span class="keywordflow">do</span>    <span class="comment">! find two approximately minimum-volume sub-cllusters recursively</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            recursioncounter = recursioncounter + 1</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>            <span class="keywordflow">if</span>(mod(recursioncounter,maxkvolumelooprecursion)==0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;recursionCounter: &#39;</span>, recursioncounter</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                ncoptimal = 1</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                cmembership = 1</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                csize(1) = np</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                <span class="keywordflow">return</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="keywordflow">            end if</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>            cmembercounter(1) = 0</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>            cmembercounter(2) = cksize(1)</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>            <span class="keywordflow">do</span> ip = 1,np</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>                <span class="keywordflow">if</span> (cmembership(ip)==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>                    cmembercounter(1) = cmembercounter(1) + 1</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>                    ckpoint(1:nd,cmembercounter(1)) = point(1:nd,ip)</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>                    ckpointindex(cmembercounter(1)) = pointindex(ip)</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>                    cmembercounter(2) = cmembercounter(2) + 1</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                    ckpoint(1:nd,cmembercounter(2)) = point(1:nd,ip)</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>                    ckpointindex(cmembercounter(2)) = pointindex(ip)</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            point = ckpoint           <span class="comment">! Point is now ordered</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>            pointindex = ckpointindex <span class="comment">! PointIndex is now ordered</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>            ipstart(1) = 1             ; ipend(1) = cksize(1)</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>            ipstart(2) = cksize(1) + 1 ; ipend(2) = np</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>            <span class="keywordflow">do</span> ic = 1,2   <span class="comment">! Get scaled Mahalanobis distances</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>                icother = 3 - ic</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>                <span class="comment">! get Cholesky Factor of cluster samples</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                <span class="keyword">call </span><a class="code hl_function" href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">getsamcholfac</a>  ( nd &amp;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                                    , cksize(ic) &amp;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                                    , ckcenter(1:nd,ic) &amp;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                                    , point(1:nd,ipstart(ic):ipend(ic)) &amp;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                                    , ckbecholcov(1:nd,1:nd,ic) &amp;</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                                    , ckbecholdiag(1:nd,ic) &amp;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                                    )</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                <span class="keywordflow">if</span> (ckbecholdiag(1,ic)&lt;0._rk) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                    <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;    FATAL: runMinVolKernel() @ getSamCholFac() @ getCholeskyFactor() failed.&quot;</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>                    <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;           Cluster id, dimension, size:&quot;</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>                    <span class="keyword">write</span>(*,*) ic, nd, cksize(ic)</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                    stop</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                ckbeinvcovmat(1:nd,1:nd,ic) = <a class="code hl_function" href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">getinvmatfromcholfac</a>( nd, ckbecholcov(1:nd,1:nd,ic), ckbecholdiag(1:nd,ic) )</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                ckmahalsq(1:np,ic) = <a class="code hl_interface" href="interfacestatistics__mod_1_1getmahalsq.html">getmahalsq</a>( nd, np, ckcenter(1:nd,ic), ckbeinvcovmat(1:nd,1:nd,ic), point )</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                scalefacsq(ic) = maxval(ckmahalsq(ipstart(ic):ipend(ic),ic))</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                scalefac(ic) = sqrt( scalefacsq(ic) )</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                ckmahalsq(1:np,ic) = ckmahalsq(1:np,ic) / scalefacsq(ic)</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                ckbevolnormed(ic) = exp( nd*log(scalefac(ic)) + sum(log(ckbecholdiag(1:nd,ic))) - lognormfac ) <span class="comment">! Get the LogVolume of the cluster</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>                numpointinck(ic) = cksize(ic) + inclusionfraction*count(ckmahalsq(ipstart(icother):ipend(icother),ic)&lt;1._rk)</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                ckparvolnormed(ic) = real(numpointinck(ic),kind=rk) * parvolnormed / real(np,kind=rk)</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                blockstabilitycheck: <span class="keywordflow">if</span> (stabilizationrequested) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                    <span class="keywordflow">if</span> ( ckbevolnormed(ic) &gt; ckbevolnormedold(ic) ) <span class="keywordflow">then</span>    <span class="comment">! This is to ensure the convergence of the algorithm</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                        ckcenter(1:nd,ic) = ckcenterold(1:nd,ic)</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                        ckbecholcov(1:nd,1:nd,ic) = ckbecholcovold(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                        ckbecholdiag(1:nd,ic) = ckbecholdiagold(1:nd,ic)</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                        ckbeinvcovmat(1:nd,1:nd,ic) = ckbeinvcovmatold(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                        scalefacsq(ic) = scalefacsqold(ic)</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                        scalefac(ic) = scalefacold(ic)</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>                        ckbevolnormed(ic) = ckbevolnormedold(ic)</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>                        cmembercounter(1) = 0</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>                        cmembercounter(2) = cksize(1)</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>                        <span class="keywordflow">do</span> ip = 1,np</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>                            <span class="keywordflow">if</span> (cmembership(ip)==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>                                cmembercounter(1) = cmembercounter(1) + 1</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>                                ckmahalsq(cmembercounter(1),ic) = ckmahalsqold(ip,ic)</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>                            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                                cmembercounter(2) = cmembercounter(2) + 1</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>                                ckmahalsq(cmembercounter(2),ic) = ckmahalsqold(ip,ic)</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span><span class="keywordflow">                            end if</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span><span class="keywordflow">                        end do</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>                        ckmahalsqold(1:np,ic) = ckmahalsq(1:np,ic)</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                    <span class="keywordflow">else</span>  <span class="comment">! no stability correction is required. Everything just fine...</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>                        ckcenterold(1:nd,ic) = ckcenter(1:nd,ic)</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                        ckbecholcovold(1:nd,1:nd,ic) = ckbecholcov(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>                        ckbecholdiagold(1:nd,ic) = ckbecholdiag(1:nd,ic)</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>                        ckbeinvcovmatold(1:nd,1:nd,ic) = ckbeinvcovmat(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>                        ckmahalsqold(1:np,ic) = ckmahalsq(1:np,ic)</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>                        scalefacsqold(ic) = scalefacsq(ic)</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                        scalefacold(ic) = scalefac(ic)</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>                        ckbevolnormedold(ic) = ckbevolnormed(ic)</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span> </div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="keywordflow">                    end if</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="keywordflow">                end if</span> blockstabilitycheck</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>                <span class="comment">!if (CKBEVolNormed(ic)&lt;CKParVolNormed(ic)) then  ! enlarge the bounding ellipsoid</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>                <span class="comment">!  !write(*,*) &#39;enlargement happening...&#39;</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>                <span class="comment">!  scaleFacSq(ic) = scaleFacSq(ic) * (CKParVolNormed(ic)/CKBEVolNormed(ic))**(2._RK/nd)  ! ATTN: (1._RK/nd) this should likely be (2._RK/nd)</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>                <span class="comment">!  scaleFac(ic) = sqrt(scaleFacSq(ic))</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>                <span class="comment">!  CKBEVolNormed(ic) = CKParVolNormed(ic)</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>                <span class="comment">!end if</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="preprocessor">#if defined DEBUG_ENABLED</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span><span class="preprocessor"></span>                debugvolnorm: block</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="keywordtype">                    real</span>(rk) :: dummy</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                    dummy = real(cksize(ic),kind=rk)*parvolnormed/real(np,kind=rk)</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                    <span class="keywordflow">if</span> ( ckbevolnormed(ic) &lt; dummy ) <span class="keywordflow">then</span>  <span class="comment">! enlarge the bounding ellipsoid</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>                        <span class="comment">!write(*,*) &#39;enlargement happening...&#39;</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>                        scalefacsq(ic) = scalefacsq(ic) * (dummy/ckbevolnormed(ic))**(2._rk/nd)  <span class="comment">! ATTN: (1._RK/nd) this should likely be (2._RK/nd)</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>                        scalefac(ic) = sqrt(scalefacsq(ic))</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>                        ckbevolnormed(ic) = dummy</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="keywordflow">                    end if</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                <span class="keyword">end </span>block debugvolnorm</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="preprocessor"></span>              <span class="comment">!end if blockStabilityCheck</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>            <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span> </div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            <span class="comment">! Reassign points to clusters if needed</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            mahalsqweight = ( ckbevolnormed / ckparvolnormed )**mahalsqweightexponent</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            reclusteringneeded = .false.</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>            ckcenter(1:nd,1) = ckcenter(1:nd,1) * cksize(1)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>            ckcenter(1:nd,2) = ckcenter(1:nd,2) * cksize(2)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>            ic = 1</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>            icother = 2</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>            <span class="keywordflow">do</span> ip = ipstart(ic),ipend(ic)</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                cmembership(ip) = ic    <span class="comment">! This has not been assigned correctly in the past, here is the first attempt</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                <span class="keywordflow">if</span> ( mahalsqweight(ic)*ckmahalsq(ip,ic) &gt;= mahalsqweight(icother)*ckmahalsq(ip,icother) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                    cmembership(ip) = icother</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>                    cksize(ic) = cksize(ic) - 1</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                    cksize(icother) = cksize(icother) + 1</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                    ckcenter(1:nd,ic) = ckcenter(1:nd,ic) - point(1:nd,ip)</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                    ckcenter(1:nd,icother) = ckcenter(1:nd,icother) + point(1:nd,ip)</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                    reclusteringneeded = .true.</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>            ic = 2</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>            icother = 1</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <span class="keywordflow">do</span> ip = ipstart(ic),ipend(ic)</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>                cmembership(ip) = ic    <span class="comment">! This has not been assigned correctly in the past, here is the first attempt</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                <span class="keywordflow">if</span> ( mahalsqweight(ic)*ckmahalsq(ip,ic) &gt; mahalsqweight(icother)*ckmahalsq(ip,icother) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>                    cmembership(ip) = icother</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                    cksize(ic) = cksize(ic) - 1</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                    cksize(icother) = cksize(icother) + 1</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                    ckcenter(1:nd,ic) = ckcenter(1:nd,ic) - point(1:nd,ip)</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                    ckcenter(1:nd,icother) = ckcenter(1:nd,icother) + point(1:nd,ip)</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                    reclusteringneeded = .true.</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="keywordflow">            end do</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>            blockreclusteringneeded: <span class="keywordflow">if</span> (reclusteringneeded) <span class="keywordflow">then</span>  <span class="comment">! perform reassignment</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>                blockillegalclustersize: <span class="keywordflow">if</span> ( any(cksize&lt;minclustersize) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                    minvolfailurecounter = minvolfailurecounter + 1</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                    <span class="keywordflow">if</span> (minvolfailurecounter&gt;maxallowedminvolfailure) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>                        ncoptimal = 1</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>                        cmembership = 1</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>                        csize(1) = np</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>                        convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>                        <span class="comment">!debugMinVolFailureCounter: block</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>                        <span class="comment">!  write(*,*) &#39;minVolFailureCounter: &#39;, minVolFailureCounter</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>                        <span class="comment">!end block debugMinVolFailureCounter</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>                        <span class="keywordflow">return</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="keywordflow">                    end if</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>                    kmeansfailurecounter = 0</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>                    looprerunkmeans: <span class="keywordflow">do</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>                        <span class="keyword">call </span>runkmeans  ( nd = nd &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>                                        , np = np &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>                                        , nc = 2_ik &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>                                        , point = point &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>                                        , <span class="keyword">Size</span> = cksize &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>                                        , center = ckcenter &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>                                        , membership = cmembership &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>                                        , normedpoint = cknormedpoint &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>                                        , mindistancesq = ckmindistancesq &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>                                        , potential = potential &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>                                        , niter = iteration &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                                        , nzsci = zcsiteration &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>                                        , err = err &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>                                        <span class="comment">!, niterMax &amp; ! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                                        <span class="comment">!, nzsciMax &amp; ! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                                        <span class="comment">!, relTol &amp; ! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>                                        )</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>                        <span class="keywordflow">if</span> ( any(cksize&lt;minclustersize) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                        kmeansfailurecounter = kmeansfailurecounter + 1</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>                        <span class="keywordflow">if</span> (kmeansfailurecounter&gt;maxallowedkmeansfailure) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>                            ncoptimal = 1</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>                            cmembership = 1</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>                            csize(1) = np</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>                            convergencefailurecounter = convergencefailurecounter + 1</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>                            <span class="comment">!debugKmeansFailureCounter: block</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>                            <span class="comment">!  write(*,*) &#39;kmeansFailureCounter: &#39;, kmeansFailureCounter</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>                            <span class="comment">!end block debugKmeansFailureCounter</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>                            <span class="keywordflow">return</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="keywordflow">                        end if</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>                        cycle looprerunkmeans</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><span class="keywordflow">                        end if</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                        <span class="keywordflow">exit</span> looprerunkmeans</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span><span class="keywordflow">                    end do</span> looprerunkmeans</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>                    ckbevolnormedold = huge(0._rk)</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>                    cycle looprecursiverunminvolkernel</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="keywordflow">                end if</span> blockillegalclustersize</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span> </div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>                ckcenter(1:nd,1) = ckcenter(1:nd,1) / cksize(1)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>                ckcenter(1:nd,2) = ckcenter(1:nd,2) / cksize(2)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span> </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>                cycle looprecursiverunminvolkernel</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="keywordflow">            end if</span> blockreclusteringneeded</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>            ckcenter(1:nd,1) = ckcenter(1:nd,1) / cksize(1)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>            ckcenter(1:nd,2) = ckcenter(1:nd,2) / cksize(2)  <span class="comment">! Now it is sum instead of mean</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>            <span class="keywordflow">exit</span> looprecursiverunminvolkernel</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="keywordflow">        end do</span> looprecursiverunminvolkernel</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        <span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        furtherclusteringcheck: <span class="keywordflow">if</span> (sum(ckbevolnormed)&lt;cbevolnormed(1) .or. cbevolnormed(1)&gt;tightness*parvolnormed) <span class="keywordflow">then</span> <span class="comment">! at least two clusters is better than one. now search for more child clusters</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>            ckncmax(1) = max( cksize(1)/(ndeffective+1) , 1 )</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>            ckncmax(2) = max( cksize(2)/(ndeffective+1) , 1 )</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>            ipstart(1) = 1             ; ipend(1) = cksize(1)</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>            ipstart(2) = cksize(1) + 1 ; ipend(2) = np</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            loopsearchforchildren: <span class="keywordflow">do</span> ic = 1,2   <span class="comment">! Search for more grand-child clusters</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span> </div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>                <span class="keywordflow">if</span> (ic==1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                    icstart = 1</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>                    icend = ckncmax(1)</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                    icstart = ckncoptimal(1) + 1</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>                    icend = ckncoptimal(1) + ckncmax(2)</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>                cbevolnormed(icstart) = ckbevolnormed(ic)</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                <span class="keywordflow">if</span> (ckncmax(ic)&gt;1) <span class="keywordflow">then</span> <span class="comment">! .and. CKBEVolNormed(ic)&gt;1.1_RK*CKParVolNormed(ic)) then</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>                    <span class="keyword">call </span><a class="code hl_function" href="namespaceminvolpartition__mod.html#ae2644d3f5cfc00e7e7e10015da6ac603">runminvolkernel</a>( ncmax = ckncmax(ic) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>                                        , nd = nd &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>                                        , np = cksize(ic) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                                        , stabilizationrequested = stabilizationrequested &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                                        , maxkvolumelooprecursion = maxkvolumelooprecursion &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>                                        , maxallowedkmeansfailure = maxallowedkmeansfailure &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                                        , maxallowedminvolfailure = maxallowedminvolfailure &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>                                        , mahalsqweightexponent = mahalsqweightexponent &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>                                        , tightness = tightness &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                                        , inclusionfraction = inclusionfraction &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                                        , parvolnormed = ckparvolnormed(ic) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>                                        , lognormfac = lognormfac &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                                        , point = point(1:nd,ipstart(ic):ipend(ic)) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                                        , ncoptimal = ckncoptimal(ic) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>                                        , ccenter = ccenter(1:nd,icstart:icend) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                                        , csize = csize(icstart:icend) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>                                        , cbeinvcovmat = cbeinvcovmat(1:nd,1:nd,icstart:icend) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                                        , cbecholcov = cbecholcov(1:nd,1:nd,icstart:icend) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                                        , cbecholdiag = cbecholdiag(1:nd,icstart:icend) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>                                        , cbevolnormed = cbevolnormed(icstart:icend) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>                                        , cmembership = cmembership(ipstart(ic):ipend(ic)) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>                                        , pointindex = pointindex(ipstart(ic):ipend(ic)) &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>                                        , convergencefailurecounter = convergencefailurecounter &amp; <span class="comment">! LCOV_EXCL_LINE</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>                                        )</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>                    <span class="keywordflow">if</span> (ic==2) cmembership(ipstart(ic):ipend(ic)) = cmembership(ipstart(ic):ipend(ic)) + icstart - 1</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                    ckncoptimal(ic)=1</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>                <span class="keywordflow">if</span> ( ckncoptimal(ic)==1 .or. ckncmax(ic)==1 ) <span class="keywordflow">then</span> <span class="comment">! There is only one cluster here</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>                    ckncoptimal(ic) = 1</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>                    ccenter(1:nd,icstart) = ckcenter(1:nd,ic)</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>                    csize(icstart) = cksize(ic)</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>                    cbeinvcovmat(1:nd,1:nd,icstart) = ckbeinvcovmat(1:nd,1:nd,ic) / scalefacsq(ic)</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>                    cbecholcov(1:nd,1:nd,icstart) = ckbecholcov(1:nd,1:nd,ic)</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>                    cbecholdiag(1:nd,icstart) = ckbecholdiag(1:nd,ic)</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>                    <span class="keywordflow">do</span> j = 1,nd-1 <span class="comment">! Now rescale Cholesky factor and its diagonals, such that they describe the bounding ellipsoid of the cluster</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>                        cbecholdiag(j,icstart) = cbecholdiag(j,icstart) * scalefac(ic)</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>                        <span class="keywordflow">do</span> i = j+1,nd</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>                            cbecholcov(i,j,icstart) = cbecholcov(i,j,icstart) * scalefac(ic)</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="keywordflow">                        end do</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span><span class="keywordflow">                    end do</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>                    cbecholdiag(nd,icstart) = cbecholdiag(nd,icstart) * scalefac(ic)</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="keywordflow">                end if</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span><span class="keywordflow">            end do</span> loopsearchforchildren</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            ncoptimal = sum(ckncoptimal)</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span> </div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        <span class="keywordflow">else</span> furtherclusteringcheck  <span class="comment">! one cluster is better</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>            ncoptimal = 1</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>            cmembership = 1</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            csize(1) = np</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span><span class="keywordflow">        end if</span> furtherclusteringcheck</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span> </div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <span class="comment">!write(*,*) &#39;ncMax: &#39;, ncMax</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        <span class="comment">!write(*,*) &#39;ncOptimal: &#39;, ncOptimal</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="comment">!write(*,*) &#39;CSize: &#39;, CSize(1:ncOptimal)</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>        <span class="comment">!write(*,*) &#39;CCenter: &#39;, CCenter(:,1:ncOptimal)</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="comment">!write(*,*) &#39;Membership: &#39;, CMembership(:)</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <span class="comment">!read(*,*)</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span> </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="keyword">end subroutine </span><a class="code hl_function" href="namespaceminvolpartition__mod.html#ae2644d3f5cfc00e7e7e10015da6ac603">runminvolkernel</a></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>  <span class="keyword">end module </span>MinVolPartition_mod</div>
<div class="ttc" id="ainterfacestatistics__mod_1_1getmahalsq_html"><div class="ttname"><a href="interfacestatistics__mod_1_1getmahalsq.html">statistics_mod::getmahalsq</a></div><div class="ttdef"><b>Definition:</b> <a href="Statistics__mod_8f90_source.html#l00149">Statistics_mod.f90:149</a></div></div>
<div class="ttc" id="anamespaceconstants__mod_html"><div class="ttname"><a href="namespaceconstants__mod.html">constants_mod</a></div><div class="ttdoc">This module contains the mathematical and programming constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants__mod_8f90_source.html#l00046">Constants_mod.f90:46</a></div></div>
<div class="ttc" id="anamespaceconstants__mod_html_a7facbdd6f237b77f9c08c94fbe98e847"><div class="ttname"><a href="namespaceconstants__mod.html#a7facbdd6f237b77f9c08c94fbe98e847">constants_mod::module_name</a></div><div class="ttdeci">character(*), parameter module_name</div><div class="ttdef"><b>Definition:</b> <a href="Constants__mod_8f90_source.html#l00058">Constants_mod.f90:58</a></div></div>
<div class="ttc" id="anamespaceerr__mod_html"><div class="ttname"><a href="namespaceerr__mod.html">err_mod</a></div><div class="ttdoc">This module contains classes and procedures for reporting and handling errors.</div><div class="ttdef"><b>Definition:</b> <a href="Err__mod_8f90_source.html#l00046">Err_mod.f90:46</a></div></div>
<div class="ttc" id="anamespacekmeans__mod_html"><div class="ttname"><a href="namespacekmeans__mod.html">kmeans_mod</a></div><div class="ttdoc">This module contains procedures and routines for the Kmeans the statistical classification and cluste...</div><div class="ttdef"><b>Definition:</b> <a href="Kmeans__mod_8f90_source.html#l00048">Kmeans_mod.f90:48</a></div></div>
<div class="ttc" id="anamespacekmeans__mod_html_a217c43a3940ffade09cf8f2a1fcd9837"><div class="ttname"><a href="namespacekmeans__mod.html#a217c43a3940ffade09cf8f2a1fcd9837">kmeans_mod::runkmeans</a></div><div class="ttdeci">subroutine runkmeans(nd, np, nc, Point, Size, Center, Membership, NormedPoint, MinDistanceSq, potential, niter, nzsci, Err, InitCenter, niterMax, nzsciMax, relTol)</div><div class="ttdoc">Perform the Kmeans clustering on the input data set represented by the array Point(nd,...</div><div class="ttdef"><b>Definition:</b> <a href="Kmeans__mod_8f90_source.html#l00273">Kmeans_mod.f90:289</a></div></div>
<div class="ttc" id="anamespacematrix__mod_html"><div class="ttname"><a href="namespacematrix__mod.html">matrix_mod</a></div><div class="ttdoc">This module contains mathematical procedures.</div><div class="ttdef"><b>Definition:</b> <a href="Matrix__mod_8f90_source.html#l00046">Matrix_mod.f90:46</a></div></div>
<div class="ttc" id="anamespacematrix__mod_html_a1281fcb5ff0398b841570144bf8765fd"><div class="ttname"><a href="namespacematrix__mod.html#a1281fcb5ff0398b841570144bf8765fd">matrix_mod::getinvmatfromcholfac</a></div><div class="ttdeci">pure real(rk) function, dimension(nd, nd) getinvmatfromcholfac(nd, CholeskyLower, CholeskyDiago)</div><div class="ttdoc">Return the inverse matrix of a symmetric-positive-definite matrix, whose Cholesky Lower triangle is g...</div><div class="ttdef"><b>Definition:</b> <a href="Matrix__mod_8f90_source.html#l00247">Matrix_mod.f90:248</a></div></div>
<div class="ttc" id="anamespaceminvolpartition__mod_html"><div class="ttname"><a href="namespaceminvolpartition__mod.html">minvolpartition_mod</a></div><div class="ttdoc">This module contains procedures and routines for the minimum bounding ellipsoid partitioning of a giv...</div><div class="ttdef"><b>Definition:</b> <a href="MinVolPartition__mod_8f90_source.html#l00048">MinVolPartition_mod.f90:48</a></div></div>
<div class="ttc" id="anamespaceminvolpartition__mod_html_a82a4bdaa5cd0b54252e4b6d47b1dc2bb"><div class="ttname"><a href="namespaceminvolpartition__mod.html#a82a4bdaa5cd0b54252e4b6d47b1dc2bb">minvolpartition_mod::runminvolpartition</a></div><div class="ttdeci">subroutine runminvolpartition(ncMax, nd, np, maxKvolumeLoopRecursion, maxAllowedKmeansFailure, maxAllowedMinVolFailure, stabilizationRequested, mahalSqWeightExponent, tightness, inclusionFraction, parLogVol, Point, ncOptimal, CCenter, CSize, CBEInvCovMat, CBECholCov, CBECholDiag, CBEVolNormed, CMembership, PointIndex, convergenceFailureCounter)</div><div class="ttdef"><b>Definition:</b> <a href="MinVolPartition__mod_8f90_source.html#l00079">MinVolPartition_mod.f90:102</a></div></div>
<div class="ttc" id="anamespaceminvolpartition__mod_html_ae2644d3f5cfc00e7e7e10015da6ac603"><div class="ttname"><a href="namespaceminvolpartition__mod.html#ae2644d3f5cfc00e7e7e10015da6ac603">minvolpartition_mod::runminvolkernel</a></div><div class="ttdeci">recursive subroutine runminvolkernel(ncMax, nd, np, stabilizationRequested, maxKvolumeLoopRecursion, maxAllowedKmeansFailure, maxAllowedMinVolFailure, mahalSqWeightExponent, tightness, inclusionFraction, parVolNormed, logNormFac, Point, ncOptimal, CCenter, CSize, CBEInvCovMat, CBECholCov, CBECholDiag, CBEVolNormed, CMembership, PointIndex, convergenceFailureCounter)</div><div class="ttdef"><b>Definition:</b> <a href="MinVolPartition__mod_8f90_source.html#l00207">MinVolPartition_mod.f90:231</a></div></div>
<div class="ttc" id="anamespacestatistics__mod_html"><div class="ttname"><a href="namespacestatistics__mod.html">statistics_mod</a></div><div class="ttdoc">This module contains the classes and procedures for various statistical computations.</div><div class="ttdef"><b>Definition:</b> <a href="Statistics__mod_8f90_source.html#l00046">Statistics_mod.f90:46</a></div></div>
<div class="ttc" id="anamespacestatistics__mod_html_ae321c1cfb8f2d0f3e4980b2fa12dbde1"><div class="ttname"><a href="namespacestatistics__mod.html#ae321c1cfb8f2d0f3e4980b2fa12dbde1">statistics_mod::getsamcholfac</a></div><div class="ttdeci">subroutine getsamcholfac(nd, np, Mean, Point, CholeskyLower, CholeskyDiago)</div><div class="ttdoc">Return the lower triangle Cholesky Factor of the covariance matrix of a set of points in the lower pa...</div><div class="ttdef"><b>Definition:</b> <a href="Statistics__mod_8f90_source.html#l00998">Statistics_mod.f90:999</a></div></div>
<div class="ttc" id="astructerr__mod_1_1err__type_html"><div class="ttname"><a href="structerr__mod_1_1err__type.html">err_mod::err_type</a></div><div class="ttdoc">The error type.</div><div class="ttdef"><b>Definition:</b> <a href="Err__mod_8f90_source.html#l00059">Err_mod.f90:59</a></div></div>
<div class="ttc" id="astructminvolpartition__mod_1_1minvolpartition__type_html"><div class="ttname"><a href="structminvolpartition__mod_1_1minvolpartition__type.html">minvolpartition_mod::minvolpartition_type</a></div><div class="ttdoc">The MinVolPartition_type class. Partitions an input array Point(nd,np) with nd attributes and np obse...</div><div class="ttdef"><b>Definition:</b> <a href="MinVolPartition__mod_8f90_source.html#l00058">MinVolPartition_mod.f90:58</a></div></div>
</div><!-- fragment --></div><!-- contents -->
    <!-- start footer part -->
    <hr class="footer"/>
    <div style="text-align:center">
        <p>
            <a href="https://www.cdslab.org/paramonte"><b>ParaMonte: Plain Powerful Parallel Monte Carlo Library</b></a>&nbsp;
            &copy; Copyright 2020, <a href="https://www.cdslab.org" target="_blank"><b>The Computational Data Science Lab</b></a>
            <br/>
        </p>
    </div>
    <address class="footer">
        <small>
            Generated on Thu Aug 19 2021 18:26:38 for ParaMonte by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a>
            <!--
            1.9.2
            -->
        </small>
    </address>
    <!-- Start of statc -->
    <div style="color: #ffffff; float: none; width: 100%;">
        <span style="font-size:0.8em">
        <!--visitor count: -->
            <script type="text/javascript">
                var sc_project=12178963; 
                var sc_invisible=1; 
                var sc_security="e0dfe0f9"; 
                var sc_text=3; 
                var scJsHost = "https://";
                document.write("<sc"+"ript type='text/javascript' src='" +
                scJsHost+
                "statcounter.com/counter/counter.js'></"+"script>");
            </script>
        </span>
    </div>
</body>
</html>
