\hypertarget{ParaNest__mod_0dKernel_8f90_source}{}\doxysection{Para\+Nest\+\_\+mod@Kernel.\+f90}
\label{ParaNest__mod_0dKernel_8f90_source}\index{D:/Dropbox/Projects/20180101\_ParaMonte/git/src/kernel/\_\_\_toBeCleared\_\_\_/ParaNest\_mod"@Kernel.f90@{D:/Dropbox/Projects/20180101\_ParaMonte/git/src/kernel/\_\_\_toBeCleared\_\_\_/ParaNest\_mod"@Kernel.f90}}
\mbox{\hyperlink{ParaNest__mod_0dKernel_8f90}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00001}00001 submodule(\mbox{\hyperlink{namespaceparanest}{paranest}}) kernel}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00003}00003   \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00005}00005   \textcolor{comment}{!real(RK)          , Parameter     :: HUGE\_EXPONENT      = 7.\_RK                      ! This should not go beyond half the numerical precision of computer, which is 15 digits.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00006}00006   \textcolor{comment}{!real(RK)          , Parameter     :: NEG\_HUGE\_EXPONENT  = -\/HUGE\_EXPONENT}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00007}00007   \textcolor{comment}{!real(RK)          , Parameter     :: HUGE\_NUMBER        = huge(HUGE\_EXPONENT)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00008}00008   \textcolor{comment}{!real(RK)          , Parameter     :: TINY\_NUMBER        = tiny(NEG\_HUGE\_EXPONENT)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00009}00009   \textcolor{comment}{!real(RK)          , Parameter     :: NEG\_HUGE\_NUMBER    = -\/HUGE\_NUMBER}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00010}00010   \textcolor{comment}{!real(RK)          , Parameter     :: LOGLIKE\_DIFF\_CONST = 2.\_RK*HUGE\_EXPONENT        ! This should not go beyond the numerical precision of computer, which is 15 digits.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00012}00012 \textcolor{keyword}{contains}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00014}00014 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00015}00015 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00017}00017   \textcolor{keyword}{module} subroutine runlmc( nd, np, iverbose, ireport, logtolerance, logdomainsize, \mbox{\hyperlink{ParaMonte_0drunParaDRAM_8f90_a61612d7f17ad31a757aee8ee361f7fbd}{getlogfunc}}, passresult \&}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00018}00018                           , logfileunit, ncall2logfuncaccepted, ncall2logfunctotal )}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00020}00020    \textcolor{comment}{!use Constants      , only: RK}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00021}00021     \textcolor{keywordtype}{use }matrix          , \textcolor{keywordtype}{only}: getinvmatfromcholfac}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00022}00022     \textcolor{keywordtype}{use }specialfunctions, \textcolor{keywordtype}{only}: indexarrayreal}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00023}00023     \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00025}00025     \textcolor{keywordtype}{procedure}(logPDF)         :: getLogFunc}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00026}00026     \textcolor{keywordtype}{procedure}(PNoutputter)    :: passResult}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00027}00027     \textcolor{keywordtype}{integer}     , \textcolor{keywordtype}{intent(in)}  :: nd, np, iverbose, ireport}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00028}00028     \textcolor{keywordtype}{integer}     , \textcolor{keywordtype}{intent(in)}  :: logFileUnit                                    \textcolor{comment}{! used for outputting prgoress report}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00029}00029 \textcolor{keywordtype}{    real}(RK)    , \textcolor{keywordtype}{intent(in)}  :: logTolerance                                   \textcolor{comment}{! LogTolerance used in the calculation of the integral, used for the logMaxError in logEvidence}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00030}00030 \textcolor{keywordtype}{    real}(RK)    , \textcolor{keywordtype}{intent(in)}  :: logDomainSize                                  \textcolor{comment}{! the initial size of the domain of integration. used for proper normalization of evidence.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00031}00031     \textcolor{keywordtype}{integer}     , \textcolor{keywordtype}{intent(out)} :: nCall2LogFuncAccepted, nCall2LogFuncTotal      \textcolor{comment}{! number of evidence steps (sampled points). number of calls to the objective function.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00033}00033     \textcolor{keywordtype}{integer}                   :: LogFuncIndex(np)                               \textcolor{comment}{! index array that gives the ascending order of the elements of LogFunc active sample.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00034}00034 \textcolor{keywordtype}{    real}(RK)                  :: Point(nd,np)                                   \textcolor{comment}{! Point is the nd-\/by-\/np array of the stochastic variable for the active sample.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00035}00035 \textcolor{keywordtype}{    real}(RK)                  :: LogFunc(np)                                    \textcolor{comment}{! The vector containing LogFunc values for the active sample}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00036}00036 \textcolor{keywordtype}{    real}(RK)                  :: domainSizeNormed                               \textcolor{comment}{! domainSizeNormed is the prior mass}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00037}00037 \textcolor{keywordtype}{    real}(RK)                  :: LogFuncSwap(0:1)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00038}00038 \textcolor{keywordtype}{    real}(RK)                  :: domainDiffNormed}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00039}00039 \textcolor{keywordtype}{    real}(RK)                  :: logEvidence}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00040}00040 \textcolor{keywordtype}{    real}(RK)                  :: maxLogFunc}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00041}00041 \textcolor{keywordtype}{    real}(RK)                  :: logMaxError,accr,accrSum,accrMean}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00042}00042 \textcolor{keywordtype}{    real}(RK)                  :: domainShrinkageExponent}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00043}00043     \textcolor{keywordtype}{integer}                   :: i,minLogFuncIndex}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00045}00045     \textcolor{comment}{! Initialize the active sample}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00046}00046     \textcolor{keyword}{call }getactivesamplecars(nd,np,point,logfunc,getlogfunc)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00047}00047 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00048}00048     \textcolor{comment}{! initialize variables:}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00049}00049     ncall2logfuncaccepted = 0}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00050}00050     ncall2logfunctotal    = 1       \textcolor{comment}{! counts the total number of calls to getLogFunc()}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00051}00051     logmaxerror           = 0.\_rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00052}00052     accrsum               = 0.\_rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00053}00053     accr                  = 1.\_rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00054}00054     accrmean              = 1.\_rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00055}00055     logfuncswap(0)        = -\/huge(logfuncswap(0))    \textcolor{comment}{! Required by incrementEvidence()}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00056}00056     minlogfuncindex       = minloc(logfunc,1)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00058}00058     domainshrinkageexponent = 1.\_rk / real(np,kind=rk)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00060}00060     \textcolor{comment}{! Start sampling and logEvidence calculation}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00061}00061     looplmcsampling: \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00063}00063       \textcolor{keywordflow}{if} (mod(ncall2logfuncaccepted,iverbose)==0) \textcolor{keyword}{write}(logfileunit,*) ncall2logfuncaccepted,\textcolor{stringliteral}{' points sampled. Total function calls: '}, ncall2logfunctotal+np-\/1}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00064}00064       \textcolor{keywordflow}{if} (mod(ncall2logfuncaccepted,ireport)==0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00065}00065         \textcolor{keyword}{call }writerestartfile(nd,np,point,logfunc)    \textcolor{comment}{! write restart file}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00066}00066 \textcolor{keywordflow}{      end if}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00068}00068 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00069}00069       logfuncswap(1)   = logfunc(minlogfuncindex)     \textcolor{comment}{! LogFuncSwap(0) is the minimum LogFunc in the old active set.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00071}00071       \textcolor{keyword}{call }getdomainsize(domainshrinkageexponent,domainsizenormed,domaindiffnormed)      \textcolor{comment}{! Calculates domainDiffNormed. Swaps domainSizeNormed.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00072}00072       \textcolor{keyword}{call }incrementevidence(domaindiffnormed,logfuncswap,logevidence)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00074}00074       logfuncswap(0) = logfuncswap(1)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00076}00076       \textcolor{comment}{! Now write out the sample}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00077}00077       ncall2logfuncaccepted = ncall2logfuncaccepted + 1}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00078}00078       accrsum  = accrsum + accr}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00079}00079       accrmean = accrsum / real(ncall2logfuncaccepted,kind=rk)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00080}00080       accr = real(ncall2logfuncaccepted,kind=rk) / real(ncall2logfunctotal,kind=rk)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00081}00081       \textcolor{keyword}{call }passresult( nd, ncall2logfuncaccepted, ncall2logfunctotal, accr, accrmean, domainsizenormed, domaindiffnormed \&}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00082}00082                      , logfuncswap(1), logdomainsize+logevidence, logmaxerror, point(1:nd,minlogfuncindex) )}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00085}00085       \textcolor{comment}{! check for stopping criterion. Exit loop if integration accuracy achieved.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00086}00086       maxlogfunc = maxval(logfunc)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00087}00087       logmaxerror = maxlogfunc + log(domainsizenormed) -\/ logevidence}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00088}00088       \textcolor{keywordflow}{if} (logmaxerror < logtolerance) \textcolor{keywordflow}{then}  \textcolor{comment}{! Write out the remaining part of the logEvidence and exit sampling}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00089}00089         \textcolor{keyword}{write}(*,*) \textcolor{stringliteral}{'The desired accuracy for logEvidence achieved'}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00090}00090         \textcolor{keyword}{call }indexarrayreal(np,logfunc,logfuncindex)   \textcolor{comment}{! get the ascending order of the elements of LogFunc}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00091}00091         domaindiffnormed = 0.5\_rk*domainsizenormed/real(np)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00092}00092         \textcolor{keywordflow}{do} i = 2,np    \textcolor{comment}{! Add the final contribution to logEvidence}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00093}00093           logfuncswap(1) = logfunc(logfuncindex(i))}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00094}00094           \textcolor{keyword}{call }incrementevidence(domaindiffnormed,logfuncswap,logevidence)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00095}00095           logfuncswap(0)  = logfuncswap(1)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00096}00096           ncall2logfuncaccepted = ncall2logfuncaccepted + 1}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00097}00097           ncall2logfunctotal = ncall2logfunctotal + 1}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00098}00098           accrsum  = accrsum + accr}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00099}00099           accrmean = accrsum / real(ncall2logfuncaccepted,kind=rk)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00100}00100           accr = real(ncall2logfuncaccepted,kind=rk) / real(ncall2logfunctotal,kind=rk)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00101}00101           \textcolor{keyword}{call }passresult( nd, ncall2logfuncaccepted, ncall2logfunctotal, accr, accrmean, domainsizenormed, domaindiffnormed, logfuncswap(1) \&}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00102}00102                          , logdomainsize+logevidence, logmaxerror, point(1:nd,logfuncindex(i)) )}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00103}00103 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00104}00104         \textcolor{keywordflow}{exit} looplmcsampling}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00105}00105 \textcolor{keywordflow}{      end if}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00107}00107       \textcolor{comment}{! Now draw a new point subject to getLogFunc > LogFunc(minLogFuncIndex)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00108}00108       \textcolor{comment}{! Updates LogFunc and Point arrays with new point replacing the lowest-\/likelihood point.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00109}00109       \textcolor{comment}{! Replaces the lowest likelihood and the associated Parameter set with the new proposal values.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00110}00110       \textcolor{keyword}{call }getnewpointcars(nd,np,iverbose,ncall2logfunctotal,minlogfuncindex,point,logfunc,getlogfunc)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00112}00112       cycle looplmcsampling}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00113}00113 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00114}00114 \textcolor{keywordflow}{    end do} looplmcsampling}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00116}00116   \textcolor{keyword}{end subroutine }runlmc}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00117}00117 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00118}00118 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00119}00119 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00120}00120 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00121}00121   \textcolor{keyword}{subroutine }getdomainsize(domainShrinkageExponent,domainSizeNormed,domainDiffNormed)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00122}00122     \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00123}00123 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{intent(in)}    :: domainShrinkageExponent}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00124}00124 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{intent(out)}   :: domainSizeNormed}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00125}00125 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{intent(out)}   :: domainDiffNormed}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00126}00126 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{save}          :: domainSizeNormedCurrent = 1.\_rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00127}00127 \textcolor{keywordtype}{    real}(RK)                :: rnd}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00128}00128     \textcolor{keyword}{call }random\_number(rnd)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00129}00129     domainsizenormed = domainsizenormedcurrent * rnd**domainshrinkageexponent}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00130}00130     domaindiffnormed = 0.5\_rk * ( domainsizenormedcurrent -\/ domainsizenormed )}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00131}00131     domainsizenormedcurrent = domainsizenormed}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00132}00132   \textcolor{keyword}{end subroutine }getdomainsize}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00134}00134 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00135}00135 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00137}00137   \textcolor{comment}{! Increments logEvidence using the minimum logFunc and the corresponding stochastic prior volume associated with it.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00138}00138   \textcolor{keyword}{subroutine }incrementevidence(domainDiffNormed,LogFuncSwap,logEvidence)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00139}00139     \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceconstants__mod}{constants\_mod}} \textcolor{keywordtype}{only}: rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00140}00140     \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00141}00141 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{intent(in)}  :: domainDiffNormed,LogFuncSwap(0:1)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00142}00142 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{intent(out)} :: logEvidence}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00143}00143 \textcolor{keywordtype}{    real}(RK), \textcolor{keywordtype}{save}        :: evidenceNormed = 0.\_rk}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00144}00144 \textcolor{keywordtype}{    real}(RK)              :: logFuncRatio}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00146}00146     logfuncratio = exp( logfuncswap(0) -\/ logfuncswap(1) )        \textcolor{comment}{! This ratio is by definition always < 1.}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00147}00147     evidencenormed  = ( evidencenormed + domaindiffnormed ) * logfuncratio + domaindiffnormed  \textcolor{comment}{! evidence = evidenceNormed * exp(LogFuncSwap(1))}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00148}00148     logevidence     = log( evidencenormed ) + logfuncswap(1)}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00149}00149     \textcolor{comment}{!!!XX write(*,*) 'LogFuncSwap: ', LogFuncSwap; read(*,*)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00150}00150     \textcolor{comment}{!!!XX write(*,*) 'logFuncRatio: ', logFuncRatio; read(*,*)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00151}00151     \textcolor{comment}{!!!XX write(*,*) 'evidenceNormed, logEvidence: ', evidenceNormed, logEvidence; read(*,*)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00152}00152     \textcolor{comment}{!!!XX write(*,*) 'log[ domainDiffNormed*exp(LogFuncSwap(1)) ] : ', log(domainDiffNormed*exp(LogFuncSwap(1))); read(*,*)}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00153}00153   \textcolor{keyword}{end subroutine }incrementevidence}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00155}00155 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00156}00156 \textcolor{comment}{!****************************************************************************}}
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{ParaNest__mod_0dKernel_8f90_source_l00158}00158 \textcolor{keyword}{end }submodule Kernel}

\end{DoxyCode}
